var Xr=Object.defineProperty;var At=e=>{throw TypeError(e)};var Gr=(e,t,r)=>t in e?Xr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var v=(e,t,r)=>Gr(e,typeof t!="symbol"?t+"":t,r),st=(e,t,r)=>t.has(e)||At("Cannot "+r);var f=(e,t,r)=>(st(e,t,"read from private field"),r?r.call(e):t.get(e)),N=(e,t,r)=>t.has(e)?At("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),E=(e,t,r,a)=>(st(e,t,"write to private field"),a?a.call(e,r):t.set(e,r),r),R=(e,t,r)=>(st(e,t,"access private method"),r);var St=(e,t,r,a)=>({set _(s){E(e,t,s,r)},get _(){return f(e,t,a)}});var ar={Stringify:1},j=(e,t)=>{const r=new String(e);return r.isEscaped=!0,r.callbacks=t,r},qr=/[&<>'"]/,sr=async(e,t)=>{let r="";t||(t=[]);const a=await Promise.all(e);for(let s=a.length-1;r+=a[s],s--,!(s<0);s--){let i=a[s];typeof i=="object"&&t.push(...i.callbacks||[]);const o=i.isEscaped;if(i=await(typeof i=="object"?i.toString():i),typeof i=="object"&&t.push(...i.callbacks||[]),i.isEscaped??o)r+=i;else{const c=[r];re(i,c),r=c[0]}}return j(r,t)},re=(e,t)=>{const r=e.search(qr);if(r===-1){t[0]+=e;return}let a,s,i=0;for(s=r;s<e.length;s++){switch(e.charCodeAt(s)){case 34:a="&quot;";break;case 39:a="&#39;";break;case 38:a="&amp;";break;case 60:a="&lt;";break;case 62:a="&gt;";break;default:continue}t[0]+=e.substring(i,s)+a,i=s+1}t[0]+=e.substring(i,s)},nr=e=>{const t=e.callbacks;if(!(t!=null&&t.length))return e;const r=[e],a={};return t.forEach(s=>s({phase:ar.Stringify,buffer:r,context:a})),r[0]},ir=async(e,t,r,a,s)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const i=e.callbacks;return i!=null&&i.length?(s?s[0]+=e:s=[e],Promise.all(i.map(c=>c({phase:t,buffer:s,context:a}))).then(c=>Promise.all(c.filter(Boolean).map(l=>ir(l,t,!1,a,s))).then(()=>s[0]))):Promise.resolve(e)},zr=(e,...t)=>{const r=[""];for(let a=0,s=e.length-1;a<s;a++){r[0]+=e[a];const i=Array.isArray(t[a])?t[a].flat(1/0):[t[a]];for(let o=0,c=i.length;o<c;o++){const l=i[o];if(typeof l=="string")re(l,r);else if(typeof l=="number")r[0]+=l;else{if(typeof l=="boolean"||l===null||l===void 0)continue;if(typeof l=="object"&&l.isEscaped)if(l.callbacks)r.unshift("",l);else{const u=l.toString();u instanceof Promise?r.unshift("",u):r[0]+=u}else l instanceof Promise?r.unshift("",l):re(l.toString(),r)}}}return r[0]+=e.at(-1),r.length===1?"callbacks"in r?j(nr(j(r[0],r.callbacks))):j(r[0]):sr(r,r.callbacks)},Et=Symbol("RENDERER"),pt=Symbol("ERROR_HANDLER"),A=Symbol("STASH"),or=Symbol("INTERNAL"),Vr=Symbol("MEMO"),Qe=Symbol("PERMALINK"),Ot=e=>(e[or]=!0,e),cr=e=>({value:t,children:r})=>{if(!r)return;const a={children:[{tag:Ot(()=>{e.push(t)}),props:{}}]};Array.isArray(r)?a.children.push(...r.flat()):a.children.push(r),a.children.push({tag:Ot(()=>{e.pop()}),props:{}});const s={tag:"",props:a,type:""};return s[pt]=i=>{throw e.pop(),i},s},lr=e=>{const t=[e],r=cr(t);return r.values=t,r.Provider=r,Ne.push(r),r},Ne=[],bt=e=>{const t=[e],r=a=>{t.push(a.value);let s;try{s=a.children?(Array.isArray(a.children)?new fr("",{},a.children):a.children).toString():""}finally{t.pop()}return s instanceof Promise?s.then(i=>j(i,i.callbacks)):j(s)};return r.values=t,r.Provider=r,r[Et]=cr(t),Ne.push(r),r},Re=e=>e.values.at(-1),qe={title:[],script:["src"],style:["data-href"],link:["href"],meta:["name","httpEquiv","charset","itemProp"]},ht={},ze="data-precedence",Pe=e=>Array.isArray(e)?e:[e],Ct=new WeakMap,Ut=(e,t,r,a)=>({buffer:s,context:i})=>{if(!s)return;const o=Ct.get(i)||{};Ct.set(i,o);const c=o[e]||(o[e]=[]);let l=!1;const u=qe[e];if(u.length>0){e:for(const[,d]of c)for(const p of u)if(((d==null?void 0:d[p])??null)===(r==null?void 0:r[p])){l=!0;break e}}if(l?s[0]=s[0].replaceAll(t,""):u.length>0?c.push([t,r,a]):c.unshift([t,r,a]),s[0].indexOf("</head>")!==-1){let d;if(a===void 0)d=c.map(([p])=>p);else{const p=[];d=c.map(([m,,h])=>{let y=p.indexOf(h);return y===-1&&(p.push(h),y=p.length-1),[m,y]}).sort((m,h)=>m[1]-h[1]).map(([m])=>m)}d.forEach(p=>{s[0]=s[0].replaceAll(p,"")}),s[0]=s[0].replace(/(?=<\/head>)/,d.join(""))}},$e=(e,t,r)=>j(new $(e,r,Pe(t??[])).toString()),Be=(e,t,r,a)=>{if("itemProp"in r)return $e(e,t,r);let{precedence:s,blocking:i,...o}=r;s=a?s??"":void 0,a&&(o[ze]=s);const c=new $(e,o,Pe(t||[])).toString();return c instanceof Promise?c.then(l=>j(c,[...l.callbacks||[],Ut(e,l,o,s)])):j(c,[Ut(e,c,o,s)])},Wr=({children:e,...t})=>{const r=Nt();if(r){const a=Re(r);if(a==="svg"||a==="head")return new $("title",t,Pe(e??[]))}return Be("title",e,t,!1)},Kr=({children:e,...t})=>{const r=Nt();return["src","async"].some(a=>!t[a])||r&&Re(r)==="head"?$e("script",e,t):Be("script",e,t,!1)},Yr=({children:e,...t})=>["href","precedence"].every(r=>r in t)?(t["data-href"]=t.href,delete t.href,Be("style",e,t,!0)):$e("style",e,t),Jr=({children:e,...t})=>["onLoad","onError"].some(r=>r in t)||t.rel==="stylesheet"&&(!("precedence"in t)||"disabled"in t)?$e("link",e,t):Be("link",e,t,"precedence"in t),Zr=({children:e,...t})=>{const r=Nt();return r&&Re(r)==="head"?$e("meta",e,t):Be("meta",e,t,!1)},dr=(e,{children:t,...r})=>new $(e,r,Pe(t??[])),Qr=e=>(typeof e.action=="function"&&(e.action=Qe in e.action?e.action[Qe]:void 0),dr("form",e)),ur=(e,t)=>(typeof t.formAction=="function"&&(t.formAction=Qe in t.formAction?t.formAction[Qe]:void 0),dr(e,t)),ea=e=>ur("input",e),ta=e=>ur("button",e);const nt=Object.freeze(Object.defineProperty({__proto__:null,button:ta,form:Qr,input:ea,link:Jr,meta:Zr,script:Kr,style:Yr,title:Wr},Symbol.toStringTag,{value:"Module"}));var ra=new Map([["className","class"],["htmlFor","for"],["crossOrigin","crossorigin"],["httpEquiv","http-equiv"],["itemProp","itemprop"],["fetchPriority","fetchpriority"],["noModule","nomodule"],["formAction","formaction"]]),et=e=>ra.get(e)||e,mr=(e,t)=>{for(const[r,a]of Object.entries(e)){const s=r[0]==="-"||!/[A-Z]/.test(r)?r:r.replace(/[A-Z]/g,i=>`-${i.toLowerCase()}`);t(s,a==null?null:typeof a=="number"?s.match(/^(?:a|border-im|column(?:-c|s)|flex(?:$|-[^b])|grid-(?:ar|[^a])|font-w|li|or|sca|st|ta|wido|z)|ty$/)?`${a}`:`${a}px`:a)}},Ce=void 0,Nt=()=>Ce,aa=e=>/[A-Z]/.test(e)&&e.match(/^(?:al|basel|clip(?:Path|Rule)$|co|do|fill|fl|fo|gl|let|lig|i|marker[EMS]|o|pai|pointe|sh|st[or]|text[^L]|tr|u|ve|w)/)?e.replace(/([A-Z])/g,"-$1").toLowerCase():e,sa=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],na=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","download","formnovalidate","hidden","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Tt=(e,t)=>{for(let r=0,a=e.length;r<a;r++){const s=e[r];if(typeof s=="string")re(s,t);else{if(typeof s=="boolean"||s===null||s===void 0)continue;s instanceof $?s.toStringToBuffer(t):typeof s=="number"||s.isEscaped?t[0]+=s:s instanceof Promise?t.unshift("",s):Tt(s,t)}}},$=class{constructor(e,t,r){v(this,"tag");v(this,"props");v(this,"key");v(this,"children");v(this,"isEscaped",!0);v(this,"localContexts");this.tag=e,this.props=t,this.children=r}get type(){return this.tag}get ref(){return this.props.ref||null}toString(){var t,r;const e=[""];(t=this.localContexts)==null||t.forEach(([a,s])=>{a.values.push(s)});try{this.toStringToBuffer(e)}finally{(r=this.localContexts)==null||r.forEach(([a])=>{a.values.pop()})}return e.length===1?"callbacks"in e?nr(j(e[0],e.callbacks)).toString():e[0]:sr(e,e.callbacks)}toStringToBuffer(e){const t=this.tag,r=this.props;let{children:a}=this;e[0]+=`<${t}`;const s=Ce&&Re(Ce)==="svg"?i=>aa(et(i)):i=>et(i);for(let[i,o]of Object.entries(r))if(i=s(i),i!=="children"){if(i==="style"&&typeof o=="object"){let c="";mr(o,(l,u)=>{u!=null&&(c+=`${c?";":""}${l}:${u}`)}),e[0]+=' style="',re(c,e),e[0]+='"'}else if(typeof o=="string")e[0]+=` ${i}="`,re(o,e),e[0]+='"';else if(o!=null)if(typeof o=="number"||o.isEscaped)e[0]+=` ${i}="${o}"`;else if(typeof o=="boolean"&&na.includes(i))o&&(e[0]+=` ${i}=""`);else if(i==="dangerouslySetInnerHTML"){if(a.length>0)throw new Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");a=[j(o.__html)]}else if(o instanceof Promise)e[0]+=` ${i}="`,e.unshift('"',o);else if(typeof o=="function"){if(!i.startsWith("on")&&i!=="ref")throw new Error(`Invalid prop '${i}' of type 'function' supplied to '${t}'.`)}else e[0]+=` ${i}="`,re(o.toString(),e),e[0]+='"'}if(sa.includes(t)&&a.length===0){e[0]+="/>";return}e[0]+=">",Tt(a,e),e[0]+=`</${t}>`}},it=class extends ${toStringToBuffer(e){const{children:t}=this,r=this.tag.call(null,{...this.props,children:t.length<=1?t[0]:t});if(!(typeof r=="boolean"||r==null))if(r instanceof Promise)if(Ne.length===0)e.unshift("",r);else{const a=Ne.map(s=>[s,s.values.at(-1)]);e.unshift("",r.then(s=>(s instanceof $&&(s.localContexts=a),s)))}else r instanceof $?r.toStringToBuffer(e):typeof r=="number"||r.isEscaped?(e[0]+=r,r.callbacks&&(e.callbacks||(e.callbacks=[]),e.callbacks.push(...r.callbacks))):re(r,e)}},fr=class extends ${toStringToBuffer(e){Tt(this.children,e)}},Lt=(e,t,...r)=>{t??(t={}),r.length&&(t.children=r.length===1?r[0]:r);const a=t.key;delete t.key;const s=Ve(e,t,r);return s.key=a,s},Dt=!1,Ve=(e,t,r)=>{if(!Dt){for(const a in ht)nt[a][Et]=ht[a];Dt=!0}return typeof e=="function"?new it(e,t,r):nt[e]?new it(nt[e],t,r):e==="svg"||e==="head"?(Ce||(Ce=bt("")),new $(e,t,[new it(Ce,{value:e},r)])):new $(e,t,r)},ia=({children:e})=>new fr("",{children:e},Array.isArray(e)?e:e?[e]:[]);function n(e,t,r){let a;if(!t||!("children"in t))a=Ve(e,t,[]);else{const s=t.children;a=Array.isArray(s)?Ve(e,t,s):Ve(e,t,[s])}return a.key=r,a}var Mt=(e,t,r)=>(a,s)=>{let i=-1;return o(0);async function o(c){if(c<=i)throw new Error("next() called multiple times");i=c;let l,u=!1,d;if(e[c]?(d=e[c][0][0],a.req.routeIndex=c):d=c===e.length&&s||void 0,d)try{l=await d(a,()=>o(c+1))}catch(p){if(p instanceof Error&&t)a.error=p,l=await t(p,a),u=!0;else throw p}else a.finalized===!1&&r&&(l=await r(a));return l&&(a.finalized===!1||u)&&(a.res=l),a}},oa=Symbol(),ca=async(e,t=Object.create(null))=>{const{all:r=!1,dot:a=!1}=t,i=(e instanceof vr?e.raw.headers:e.headers).get("Content-Type");return i!=null&&i.startsWith("multipart/form-data")||i!=null&&i.startsWith("application/x-www-form-urlencoded")?la(e,{all:r,dot:a}):{}};async function la(e,t){const r=await e.formData();return r?da(r,t):{}}function da(e,t){const r=Object.create(null);return e.forEach((a,s)=>{t.all||s.endsWith("[]")?ua(r,s,a):r[s]=a}),t.dot&&Object.entries(r).forEach(([a,s])=>{a.includes(".")&&(ma(r,a,s),delete r[a])}),r}var ua=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:t.endsWith("[]")?e[t]=[r]:e[t]=r},ma=(e,t,r)=>{let a=e;const s=t.split(".");s.forEach((i,o)=>{o===s.length-1?a[i]=r:((!a[i]||typeof a[i]!="object"||Array.isArray(a[i])||a[i]instanceof File)&&(a[i]=Object.create(null)),a=a[i])})},pr=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},fa=e=>{const{groups:t,path:r}=pa(e),a=pr(r);return ha(a,t)},pa=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,a)=>{const s=`@${a}`;return t.push([s,r]),s}),{groups:t,path:e}},ha=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[a]=t[r];for(let s=e.length-1;s>=0;s--)if(e[s].includes(a)){e[s]=e[s].replace(a,t[r][1]);break}}return e},Xe={},ga=(e,t)=>{if(e==="*")return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const a=`${e}#${t}`;return Xe[a]||(r[2]?Xe[a]=t&&t[0]!==":"&&t[0]!=="*"?[a,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:Xe[a]=[e,r[1],!0]),Xe[a]}return null},_t=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},ya=e=>_t(e,decodeURI),hr=e=>{const t=e.url,r=t.indexOf("/",t.indexOf(":")+4);let a=r;for(;a<t.length;a++){const s=t.charCodeAt(a);if(s===37){const i=t.indexOf("?",a),o=t.slice(r,i===-1?void 0:i);return ya(o.includes("%25")?o.replace(/%25/g,"%2525"):o)}else if(s===63)break}return t.slice(r,a)},xa=e=>{const t=hr(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},pe=(e,t,...r)=>(r.length&&(t=pe(t,...r)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),gr=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),r=[];let a="";return t.forEach(s=>{if(s!==""&&!/\:/.test(s))a+="/"+s;else if(/\:/.test(s))if(/\?/.test(s)){r.length===0&&a===""?r.push("/"):r.push(a);const i=s.replace("?","");a+="/"+i,r.push(a)}else a+="/"+s}),r.filter((s,i,o)=>o.indexOf(s)===i)},ot=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?_t(e,xr):e):e,yr=(e,t,r)=>{let a;if(!r&&t&&!/[%+]/.test(t)){let o=e.indexOf(`?${t}`,8);for(o===-1&&(o=e.indexOf(`&${t}`,8));o!==-1;){const c=e.charCodeAt(o+t.length+1);if(c===61){const l=o+t.length+2,u=e.indexOf("&",l);return ot(e.slice(l,u===-1?void 0:u))}else if(c==38||isNaN(c))return"";o=e.indexOf(`&${t}`,o+1)}if(a=/[%+]/.test(e),!a)return}const s={};a??(a=/[%+]/.test(e));let i=e.indexOf("?",8);for(;i!==-1;){const o=e.indexOf("&",i+1);let c=e.indexOf("=",i);c>o&&o!==-1&&(c=-1);let l=e.slice(i+1,c===-1?o===-1?void 0:o:c);if(a&&(l=ot(l)),i=o,l==="")continue;let u;c===-1?u="":(u=e.slice(c+1,o===-1?void 0:o),a&&(u=ot(u))),r?(s[l]&&Array.isArray(s[l])||(s[l]=[]),s[l].push(u)):s[l]??(s[l]=u)}return t?s[t]:s},va=yr,Ea=(e,t)=>yr(e,t,!0),xr=decodeURIComponent,It=e=>_t(e,xr),ye,I,W,Er,br,gt,Y,Wt,vr=(Wt=class{constructor(e,t="/",r=[[]]){N(this,W);v(this,"raw");N(this,ye);N(this,I);v(this,"routeIndex",0);v(this,"path");v(this,"bodyCache",{});N(this,Y,e=>{const{bodyCache:t,raw:r}=this,a=t[e];if(a)return a;const s=Object.keys(t)[0];return s?t[s].then(i=>(s==="json"&&(i=JSON.stringify(i)),new Response(i)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,E(this,I,r),E(this,ye,{})}param(e){return e?R(this,W,Er).call(this,e):R(this,W,br).call(this)}query(e){return va(this.url,e)}queries(e){return Ea(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((r,a)=>{t[a]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await ca(this,e))}json(){return f(this,Y).call(this,"text").then(e=>JSON.parse(e))}text(){return f(this,Y).call(this,"text")}arrayBuffer(){return f(this,Y).call(this,"arrayBuffer")}blob(){return f(this,Y).call(this,"blob")}formData(){return f(this,Y).call(this,"formData")}addValidatedData(e,t){f(this,ye)[e]=t}valid(e){return f(this,ye)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[oa](){return f(this,I)}get matchedRoutes(){return f(this,I)[0].map(([[,e]])=>e)}get routePath(){return f(this,I)[0].map(([[,e]])=>e)[this.routeIndex].path}},ye=new WeakMap,I=new WeakMap,W=new WeakSet,Er=function(e){const t=f(this,I)[0][this.routeIndex][1][e],r=R(this,W,gt).call(this,t);return r&&/\%/.test(r)?It(r):r},br=function(){const e={},t=Object.keys(f(this,I)[0][this.routeIndex][1]);for(const r of t){const a=R(this,W,gt).call(this,f(this,I)[0][this.routeIndex][1][r]);a!==void 0&&(e[r]=/\%/.test(a)?It(a):a)}return e},gt=function(e){return f(this,I)[1]?f(this,I)[1][e]:e},Y=new WeakMap,Wt),ba="text/plain; charset=UTF-8",ct=(e,t)=>({"Content-Type":e,...t}),De,Me,G,xe,q,M,Ie,ve,Ee,ie,je,Fe,J,he,Kt,Na=(Kt=class{constructor(e,t){N(this,J);N(this,De);N(this,Me);v(this,"env",{});N(this,G);v(this,"finalized",!1);v(this,"error");N(this,xe);N(this,q);N(this,M);N(this,Ie);N(this,ve);N(this,Ee);N(this,ie);N(this,je);N(this,Fe);v(this,"render",(...e)=>(f(this,ve)??E(this,ve,t=>this.html(t)),f(this,ve).call(this,...e)));v(this,"setLayout",e=>E(this,Ie,e));v(this,"getLayout",()=>f(this,Ie));v(this,"setRenderer",e=>{E(this,ve,e)});v(this,"header",(e,t,r)=>{this.finalized&&E(this,M,new Response(f(this,M).body,f(this,M)));const a=f(this,M)?f(this,M).headers:f(this,ie)??E(this,ie,new Headers);t===void 0?a.delete(e):r!=null&&r.append?a.append(e,t):a.set(e,t)});v(this,"status",e=>{E(this,xe,e)});v(this,"set",(e,t)=>{f(this,G)??E(this,G,new Map),f(this,G).set(e,t)});v(this,"get",e=>f(this,G)?f(this,G).get(e):void 0);v(this,"newResponse",(...e)=>R(this,J,he).call(this,...e));v(this,"body",(e,t,r)=>R(this,J,he).call(this,e,t,r));v(this,"text",(e,t,r)=>!f(this,ie)&&!f(this,xe)&&!t&&!r&&!this.finalized?new Response(e):R(this,J,he).call(this,e,t,ct(ba,r)));v(this,"json",(e,t,r)=>R(this,J,he).call(this,JSON.stringify(e),t,ct("application/json",r)));v(this,"html",(e,t,r)=>{const a=s=>R(this,J,he).call(this,s,t,ct("text/html; charset=UTF-8",r));return typeof e=="object"?ir(e,ar.Stringify,!1,{}).then(a):a(e)});v(this,"redirect",(e,t)=>{const r=String(e);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,t??302)});v(this,"notFound",()=>(f(this,Ee)??E(this,Ee,()=>new Response),f(this,Ee).call(this,this)));E(this,De,e),t&&(E(this,q,t.executionCtx),this.env=t.env,E(this,Ee,t.notFoundHandler),E(this,Fe,t.path),E(this,je,t.matchResult))}get req(){return f(this,Me)??E(this,Me,new vr(f(this,De),f(this,Fe),f(this,je))),f(this,Me)}get event(){if(f(this,q)&&"respondWith"in f(this,q))return f(this,q);throw Error("This context has no FetchEvent")}get executionCtx(){if(f(this,q))return f(this,q);throw Error("This context has no ExecutionContext")}get res(){return f(this,M)||E(this,M,new Response(null,{headers:f(this,ie)??E(this,ie,new Headers)}))}set res(e){if(f(this,M)&&e){e=new Response(e.body,e);for(const[t,r]of f(this,M).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const a=f(this,M).headers.getSetCookie();e.headers.delete("set-cookie");for(const s of a)e.headers.append("set-cookie",s)}else e.headers.set(t,r)}E(this,M,e),this.finalized=!0}get var(){return f(this,G)?Object.fromEntries(f(this,G)):{}}},De=new WeakMap,Me=new WeakMap,G=new WeakMap,xe=new WeakMap,q=new WeakMap,M=new WeakMap,Ie=new WeakMap,ve=new WeakMap,Ee=new WeakMap,ie=new WeakMap,je=new WeakMap,Fe=new WeakMap,J=new WeakSet,he=function(e,t,r){const a=f(this,M)?new Headers(f(this,M).headers):f(this,ie)??new Headers;if(typeof t=="object"&&"headers"in t){const i=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(const[o,c]of i)o.toLowerCase()==="set-cookie"?a.append(o,c):a.set(o,c)}if(r)for(const[i,o]of Object.entries(r))if(typeof o=="string")a.set(i,o);else{a.delete(i);for(const c of o)a.append(i,c)}const s=typeof t=="number"?t:(t==null?void 0:t.status)??f(this,xe);return new Response(e,{status:s,headers:a})},Kt),O="ALL",Ta="all",_a=["get","post","put","delete","options","patch"],Nr="Can not add a route since the matcher is already built.",Tr=class extends Error{},Ra="__COMPOSED_HANDLER",wa=e=>e.text("404 Not Found",404),jt=(e,t)=>{if("getResponse"in e){const r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},F,C,Rr,k,se,We,Ke,Yt,_r=(Yt=class{constructor(t={}){N(this,C);v(this,"get");v(this,"post");v(this,"put");v(this,"delete");v(this,"options");v(this,"patch");v(this,"all");v(this,"on");v(this,"use");v(this,"router");v(this,"getPath");v(this,"_basePath","/");N(this,F,"/");v(this,"routes",[]);N(this,k,wa);v(this,"errorHandler",jt);v(this,"onError",t=>(this.errorHandler=t,this));v(this,"notFound",t=>(E(this,k,t),this));v(this,"fetch",(t,...r)=>R(this,C,Ke).call(this,t,r[1],r[0],t.method));v(this,"request",(t,r,a,s)=>t instanceof Request?this.fetch(r?new Request(t,r):t,a,s):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${pe("/",t)}`,r),a,s)));v(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(R(this,C,Ke).call(this,t.request,t,void 0,t.request.method))})});[..._a,Ta].forEach(i=>{this[i]=(o,...c)=>(typeof o=="string"?E(this,F,o):R(this,C,se).call(this,i,f(this,F),o),c.forEach(l=>{R(this,C,se).call(this,i,f(this,F),l)}),this)}),this.on=(i,o,...c)=>{for(const l of[o].flat()){E(this,F,l);for(const u of[i].flat())c.map(d=>{R(this,C,se).call(this,u.toUpperCase(),f(this,F),d)})}return this},this.use=(i,...o)=>(typeof i=="string"?E(this,F,i):(E(this,F,"*"),o.unshift(i)),o.forEach(c=>{R(this,C,se).call(this,O,f(this,F),c)}),this);const{strict:a,...s}=t;Object.assign(this,s),this.getPath=a??!0?t.getPath??hr:xa}route(t,r){const a=this.basePath(t);return r.routes.map(s=>{var o;let i;r.errorHandler===jt?i=s.handler:(i=async(c,l)=>(await Mt([],r.errorHandler)(c,()=>s.handler(c,l))).res,i[Ra]=s.handler),R(o=a,C,se).call(o,s.method,s.path,i)}),this}basePath(t){const r=R(this,C,Rr).call(this);return r._basePath=pe(this._basePath,t),r}mount(t,r,a){let s,i;a&&(typeof a=="function"?i=a:(i=a.optionHandler,a.replaceRequest===!1?s=l=>l:s=a.replaceRequest));const o=i?l=>{const u=i(l);return Array.isArray(u)?u:[u]}:l=>{let u;try{u=l.executionCtx}catch{}return[l.env,u]};s||(s=(()=>{const l=pe(this._basePath,t),u=l==="/"?0:l.length;return d=>{const p=new URL(d.url);return p.pathname=p.pathname.slice(u)||"/",new Request(p,d)}})());const c=async(l,u)=>{const d=await r(s(l.req.raw),...o(l));if(d)return d;await u()};return R(this,C,se).call(this,O,pe(t,"*"),c),this}},F=new WeakMap,C=new WeakSet,Rr=function(){const t=new _r({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,E(t,k,f(this,k)),t.routes=this.routes,t},k=new WeakMap,se=function(t,r,a){t=t.toUpperCase(),r=pe(this._basePath,r);const s={basePath:this._basePath,path:r,method:t,handler:a};this.router.add(t,r,[a,s]),this.routes.push(s)},We=function(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t},Ke=function(t,r,a,s){if(s==="HEAD")return(async()=>new Response(null,await R(this,C,Ke).call(this,t,r,a,"GET")))();const i=this.getPath(t,{env:a}),o=this.router.match(s,i),c=new Na(t,{path:i,matchResult:o,env:a,executionCtx:r,notFoundHandler:f(this,k)});if(o[0].length===1){let u;try{u=o[0][0][0][0](c,async()=>{c.res=await f(this,k).call(this,c)})}catch(d){return R(this,C,We).call(this,d,c)}return u instanceof Promise?u.then(d=>d||(c.finalized?c.res:f(this,k).call(this,c))).catch(d=>R(this,C,We).call(this,d,c)):u??f(this,k).call(this,c)}const l=Mt(o[0],this.errorHandler,f(this,k));return(async()=>{try{const u=await l(c);if(!u.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return u.res}catch(u){return R(this,C,We).call(this,u,c)}})()},Yt),tt="[^/]+",Se=".*",Oe="(?:|/.*)",ge=Symbol(),Aa=new Set(".\\+*[^]$()");function Sa(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===Se||e===Oe?1:t===Se||t===Oe?-1:e===tt?1:t===tt?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var oe,ce,P,Jt,yt=(Jt=class{constructor(){N(this,oe);N(this,ce);N(this,P,Object.create(null))}insert(t,r,a,s,i){if(t.length===0){if(f(this,oe)!==void 0)throw ge;if(i)return;E(this,oe,r);return}const[o,...c]=t,l=o==="*"?c.length===0?["","",Se]:["","",tt]:o==="/*"?["","",Oe]:o.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let u;if(l){const d=l[1];let p=l[2]||tt;if(d&&l[2]&&(p===".*"||(p=p.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(p))))throw ge;if(u=f(this,P)[p],!u){if(Object.keys(f(this,P)).some(m=>m!==Se&&m!==Oe))throw ge;if(i)return;u=f(this,P)[p]=new yt,d!==""&&E(u,ce,s.varIndex++)}!i&&d!==""&&a.push([d,f(u,ce)])}else if(u=f(this,P)[o],!u){if(Object.keys(f(this,P)).some(d=>d.length>1&&d!==Se&&d!==Oe))throw ge;if(i)return;u=f(this,P)[o]=new yt}u.insert(c,r,a,s,i)}buildRegExpStr(){const r=Object.keys(f(this,P)).sort(Sa).map(a=>{const s=f(this,P)[a];return(typeof f(s,ce)=="number"?`(${a})@${f(s,ce)}`:Aa.has(a)?`\\${a}`:a)+s.buildRegExpStr()});return typeof f(this,oe)=="number"&&r.unshift(`#${f(this,oe)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},oe=new WeakMap,ce=new WeakMap,P=new WeakMap,Jt),rt,ke,Zt,Oa=(Zt=class{constructor(){N(this,rt,{varIndex:0});N(this,ke,new yt)}insert(e,t,r){const a=[],s=[];for(let o=0;;){let c=!1;if(e=e.replace(/\{[^}]+\}/g,l=>{const u=`@\\${o}`;return s[o]=[u,l],o++,c=!0,u}),!c)break}const i=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let o=s.length-1;o>=0;o--){const[c]=s[o];for(let l=i.length-1;l>=0;l--)if(i[l].indexOf(c)!==-1){i[l]=i[l].replace(c,s[o][1]);break}}return f(this,ke).insert(i,t,a,f(this,rt),r),a}buildRegExp(){let e=f(this,ke).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],a=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(s,i,o)=>i!==void 0?(r[++t]=Number(i),"$()"):(o!==void 0&&(a[Number(o)]=++t),"")),[new RegExp(`^${e}`),r,a]}},rt=new WeakMap,ke=new WeakMap,Zt),wr=[],Ca=[/^$/,[],Object.create(null)],Ye=Object.create(null);function Ar(e){return Ye[e]??(Ye[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function Ua(){Ye=Object.create(null)}function La(e){var u;const t=new Oa,r=[];if(e.length===0)return Ca;const a=e.map(d=>[!/\*|\/:/.test(d[0]),...d]).sort(([d,p],[m,h])=>d?1:m?-1:p.length-h.length),s=Object.create(null);for(let d=0,p=-1,m=a.length;d<m;d++){const[h,y,g]=a[d];h?s[y]=[g.map(([b])=>[b,Object.create(null)]),wr]:p++;let x;try{x=t.insert(y,p,h)}catch(b){throw b===ge?new Tr(y):b}h||(r[p]=g.map(([b,T])=>{const w=Object.create(null);for(T-=1;T>=0;T--){const[_,L]=x[T];w[_]=L}return[b,w]}))}const[i,o,c]=t.buildRegExp();for(let d=0,p=r.length;d<p;d++)for(let m=0,h=r[d].length;m<h;m++){const y=(u=r[d][m])==null?void 0:u[1];if(!y)continue;const g=Object.keys(y);for(let x=0,b=g.length;x<b;x++)y[g[x]]=c[y[g[x]]]}const l=[];for(const d in o)l[d]=r[o[d]];return[i,l,s]}function me(e,t){if(e){for(const r of Object.keys(e).sort((a,s)=>s.length-a.length))if(Ar(r).test(t))return[...e[r]]}}var Z,Q,_e,Sr,Or,Qt,Da=(Qt=class{constructor(){N(this,_e);v(this,"name","RegExpRouter");N(this,Z);N(this,Q);E(this,Z,{[O]:Object.create(null)}),E(this,Q,{[O]:Object.create(null)})}add(e,t,r){var c;const a=f(this,Z),s=f(this,Q);if(!a||!s)throw new Error(Nr);a[e]||[a,s].forEach(l=>{l[e]=Object.create(null),Object.keys(l[O]).forEach(u=>{l[e][u]=[...l[O][u]]})}),t==="/*"&&(t="*");const i=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const l=Ar(t);e===O?Object.keys(a).forEach(u=>{var d;(d=a[u])[t]||(d[t]=me(a[u],t)||me(a[O],t)||[])}):(c=a[e])[t]||(c[t]=me(a[e],t)||me(a[O],t)||[]),Object.keys(a).forEach(u=>{(e===O||e===u)&&Object.keys(a[u]).forEach(d=>{l.test(d)&&a[u][d].push([r,i])})}),Object.keys(s).forEach(u=>{(e===O||e===u)&&Object.keys(s[u]).forEach(d=>l.test(d)&&s[u][d].push([r,i]))});return}const o=gr(t)||[t];for(let l=0,u=o.length;l<u;l++){const d=o[l];Object.keys(s).forEach(p=>{var m;(e===O||e===p)&&((m=s[p])[d]||(m[d]=[...me(a[p],d)||me(a[O],d)||[]]),s[p][d].push([r,i-u+l+1]))})}}match(e,t){Ua();const r=R(this,_e,Sr).call(this);return this.match=(a,s)=>{const i=r[a]||r[O],o=i[2][s];if(o)return o;const c=s.match(i[0]);if(!c)return[[],wr];const l=c.indexOf("",1);return[i[1][l],c]},this.match(e,t)}},Z=new WeakMap,Q=new WeakMap,_e=new WeakSet,Sr=function(){const e=Object.create(null);return Object.keys(f(this,Q)).concat(Object.keys(f(this,Z))).forEach(t=>{e[t]||(e[t]=R(this,_e,Or).call(this,t))}),E(this,Z,E(this,Q,void 0)),e},Or=function(e){const t=[];let r=e===O;return[f(this,Z),f(this,Q)].forEach(a=>{const s=a[e]?Object.keys(a[e]).map(i=>[i,a[e][i]]):[];s.length!==0?(r||(r=!0),t.push(...s)):e!==O&&t.push(...Object.keys(a[O]).map(i=>[i,a[O][i]]))}),r?La(t):null},Qt),ee,z,er,Ma=(er=class{constructor(e){v(this,"name","SmartRouter");N(this,ee,[]);N(this,z,[]);E(this,ee,e.routers)}add(e,t,r){if(!f(this,z))throw new Error(Nr);f(this,z).push([e,t,r])}match(e,t){if(!f(this,z))throw new Error("Fatal error");const r=f(this,ee),a=f(this,z),s=r.length;let i=0,o;for(;i<s;i++){const c=r[i];try{for(let l=0,u=a.length;l<u;l++)c.add(...a[l]);o=c.match(e,t)}catch(l){if(l instanceof Tr)continue;throw l}this.match=c.match.bind(c),E(this,ee,[c]),E(this,z,void 0);break}if(i===s)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,o}get activeRouter(){if(f(this,z)||f(this,ee).length!==1)throw new Error("No active router has been determined yet.");return f(this,ee)[0]}},ee=new WeakMap,z=new WeakMap,er),we=Object.create(null),te,D,le,be,U,V,ne,tr,Cr=(tr=class{constructor(e,t,r){N(this,V);N(this,te);N(this,D);N(this,le);N(this,be,0);N(this,U,we);if(E(this,D,r||Object.create(null)),E(this,te,[]),e&&t){const a=Object.create(null);a[e]={handler:t,possibleKeys:[],score:0},E(this,te,[a])}E(this,le,[])}insert(e,t,r){E(this,be,++St(this,be)._);let a=this;const s=fa(t),i=[];for(let o=0,c=s.length;o<c;o++){const l=s[o],u=s[o+1],d=ga(l,u),p=Array.isArray(d)?d[0]:l;if(p in f(a,D)){a=f(a,D)[p],d&&i.push(d[1]);continue}f(a,D)[p]=new Cr,d&&(f(a,le).push(d),i.push(d[1])),a=f(a,D)[p]}return f(a,te).push({[e]:{handler:r,possibleKeys:i.filter((o,c,l)=>l.indexOf(o)===c),score:f(this,be)}}),a}search(e,t){var c;const r=[];E(this,U,we);let s=[this];const i=pr(t),o=[];for(let l=0,u=i.length;l<u;l++){const d=i[l],p=l===u-1,m=[];for(let h=0,y=s.length;h<y;h++){const g=s[h],x=f(g,D)[d];x&&(E(x,U,f(g,U)),p?(f(x,D)["*"]&&r.push(...R(this,V,ne).call(this,f(x,D)["*"],e,f(g,U))),r.push(...R(this,V,ne).call(this,x,e,f(g,U)))):m.push(x));for(let b=0,T=f(g,le).length;b<T;b++){const w=f(g,le)[b],_=f(g,U)===we?{}:{...f(g,U)};if(w==="*"){const K=f(g,D)["*"];K&&(r.push(...R(this,V,ne).call(this,K,e,f(g,U))),E(K,U,_),m.push(K));continue}const[L,ue,ae]=w;if(!d&&!(ae instanceof RegExp))continue;const B=f(g,D)[L],Hr=i.slice(l).join("/");if(ae instanceof RegExp){const K=ae.exec(Hr);if(K){if(_[ue]=K[0],r.push(...R(this,V,ne).call(this,B,e,f(g,U),_)),Object.keys(f(B,D)).length){E(B,U,_);const at=((c=K[0].match(/\//))==null?void 0:c.length)??0;(o[at]||(o[at]=[])).push(B)}continue}}(ae===!0||ae.test(d))&&(_[ue]=d,p?(r.push(...R(this,V,ne).call(this,B,e,_,f(g,U))),f(B,D)["*"]&&r.push(...R(this,V,ne).call(this,f(B,D)["*"],e,_,f(g,U)))):(E(B,U,_),m.push(B)))}}s=m.concat(o.shift()??[])}return r.length>1&&r.sort((l,u)=>l.score-u.score),[r.map(({handler:l,params:u})=>[l,u])]}},te=new WeakMap,D=new WeakMap,le=new WeakMap,be=new WeakMap,U=new WeakMap,V=new WeakSet,ne=function(e,t,r,a){const s=[];for(let i=0,o=f(e,te).length;i<o;i++){const c=f(e,te)[i],l=c[t]||c[O],u={};if(l!==void 0&&(l.params=Object.create(null),s.push(l),r!==we||a&&a!==we))for(let d=0,p=l.possibleKeys.length;d<p;d++){const m=l.possibleKeys[d],h=u[l.score];l.params[m]=a!=null&&a[m]&&!h?a[m]:r[m]??(a==null?void 0:a[m]),u[l.score]=!0}}return s},tr),de,rr,Ia=(rr=class{constructor(){v(this,"name","TrieRouter");N(this,de);E(this,de,new Cr)}add(e,t,r){const a=gr(t);if(a){for(let s=0,i=a.length;s<i;s++)f(this,de).insert(e,a[s],r);return}f(this,de).insert(e,t,r)}match(e,t){return f(this,de).search(e,t)}},de=new WeakMap,rr),Ur=class extends _r{constructor(e={}){super(e),this.router=e.router??new Ma({routers:[new Da,new Ia]})}},ja=e=>{const r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},a=(i=>typeof i=="string"?i==="*"?()=>i:o=>i===o?o:null:typeof i=="function"?i:o=>i.includes(o)?o:null)(r.origin),s=(i=>typeof i=="function"?i:Array.isArray(i)?()=>i:()=>[])(r.allowMethods);return async function(o,c){var d;function l(p,m){o.res.headers.set(p,m)}const u=await a(o.req.header("origin")||"",o);if(u&&l("Access-Control-Allow-Origin",u),r.origin!=="*"){const p=o.req.header("Vary");p?l("Vary",p):l("Vary","Origin")}if(r.credentials&&l("Access-Control-Allow-Credentials","true"),(d=r.exposeHeaders)!=null&&d.length&&l("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),o.req.method==="OPTIONS"){r.maxAge!=null&&l("Access-Control-Max-Age",r.maxAge.toString());const p=await s(o.req.header("origin")||"",o);p.length&&l("Access-Control-Allow-Methods",p.join(","));let m=r.allowHeaders;if(!(m!=null&&m.length)){const h=o.req.header("Access-Control-Request-Headers");h&&(m=h.split(/\s*,\s*/))}return m!=null&&m.length&&(l("Access-Control-Allow-Headers",m.join(",")),o.res.headers.append("Vary","Access-Control-Request-Headers")),o.res.headers.delete("Content-Length"),o.res.headers.delete("Content-Type"),new Response(null,{headers:o.res.headers,status:204,statusText:"No Content"})}await c()}};function Fa(){const{process:e,Deno:t}=globalThis;return!(typeof(t==null?void 0:t.noColor)=="boolean"?t.noColor:e!==void 0?"NO_COLOR"in(e==null?void 0:e.env):!1)}async function ka(){const{navigator:e}=globalThis,t="cloudflare:workers";return!(e!==void 0&&e.userAgent==="Cloudflare-Workers"?await(async()=>{try{return"NO_COLOR"in((await import(t)).env??{})}catch{return!1}})():!Fa())}var Pa=e=>{const[t,r]=[",","."];return e.map(s=>s.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+t)).join(r)},$a=e=>{const t=Date.now()-e;return Pa([t<1e3?t+"ms":Math.round(t/1e3)+"s"])},Ba=async e=>{if(await ka())switch(e/100|0){case 5:return`\x1B[31m${e}\x1B[0m`;case 4:return`\x1B[33m${e}\x1B[0m`;case 3:return`\x1B[36m${e}\x1B[0m`;case 2:return`\x1B[32m${e}\x1B[0m`}return`${e}`};async function Ft(e,t,r,a,s=0,i){const o=t==="<--"?`${t} ${r} ${a}`:`${t} ${r} ${a} ${await Ba(s)} ${i}`;e(o)}var Ha=(e=console.log)=>async function(r,a){const{method:s,url:i}=r.req,o=i.slice(i.indexOf("/",8));await Ft(e,"<--",s,o);const c=Date.now();await a(),await Ft(e,"-->",s,o,r.res.status,$a(c))},Xa=/^\s*(?:text\/(?!event-stream(?:[;\s]|$))[^;\s]+|application\/(?:javascript|json|xml|xml-dtd|ecmascript|dart|postscript|rtf|tar|toml|vnd\.dart|vnd\.ms-fontobject|vnd\.ms-opentype|wasm|x-httpd-php|x-javascript|x-ns-proxy-autoconfig|x-sh|x-tar|x-virtualbox-hdd|x-virtualbox-ova|x-virtualbox-ovf|x-virtualbox-vbox|x-virtualbox-vdi|x-virtualbox-vhd|x-virtualbox-vmdk|x-www-form-urlencoded)|font\/(?:otf|ttf)|image\/(?:bmp|vnd\.adobe\.photoshop|vnd\.microsoft\.icon|vnd\.ms-dds|x-icon|x-ms-bmp)|message\/rfc822|model\/gltf-binary|x-shader\/x-fragment|x-shader\/x-vertex|[^;\s]+?\+(?:json|text|xml|yaml))(?:[;\s]|$)/i,kt=(e,t=qa)=>{const r=/\.([a-zA-Z0-9]+?)$/,a=e.match(r);if(!a)return;let s=t[a[1]];return s&&s.startsWith("text")&&(s+="; charset=utf-8"),s},Ga={aac:"audio/aac",avi:"video/x-msvideo",avif:"image/avif",av1:"video/av1",bin:"application/octet-stream",bmp:"image/bmp",css:"text/css",csv:"text/csv",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",map:"application/json",mid:"audio/x-midi",midi:"audio/x-midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",pdf:"application/pdf",png:"image/png",rtf:"application/rtf",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",wasm:"application/wasm",webm:"video/webm",weba:"audio/webm",webmanifest:"application/manifest+json",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xml:"application/xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2",gltf:"model/gltf+json",glb:"model/gltf-binary"},qa=Ga,za=(...e)=>{let t=e.filter(s=>s!=="").join("/");t=t.replace(new RegExp("(?<=\\/)\\/+","g"),"");const r=t.split("/"),a=[];for(const s of r)s===".."&&a.length>0&&a.at(-1)!==".."?a.pop():s!=="."&&a.push(s);return a.join("/")||"."},Lr={br:".br",zstd:".zst",gzip:".gz"},Va=Object.keys(Lr),Wa="index.html",Ka=e=>{const t=e.root??"./",r=e.path,a=e.join??za;return async(s,i)=>{var d,p,m,h;if(s.finalized)return i();let o;if(e.path)o=e.path;else try{if(o=decodeURIComponent(s.req.path),/(?:^|[\/\\])\.\.(?:$|[\/\\])/.test(o))throw new Error}catch{return await((d=e.onNotFound)==null?void 0:d.call(e,s.req.path,s)),i()}let c=a(t,!r&&e.rewriteRequestPath?e.rewriteRequestPath(o):o);e.isDir&&await e.isDir(c)&&(c=a(c,Wa));const l=e.getContent;let u=await l(c,s);if(u instanceof Response)return s.newResponse(u.body,u);if(u){const y=e.mimes&&kt(c,e.mimes)||kt(c);if(s.header("Content-Type",y||"application/octet-stream"),e.precompressed&&(!y||Xa.test(y))){const g=new Set((p=s.req.header("Accept-Encoding"))==null?void 0:p.split(",").map(x=>x.trim()));for(const x of Va){if(!g.has(x))continue;const b=await l(c+Lr[x],s);if(b){u=b,s.header("Content-Encoding",x),s.header("Vary","Accept-Encoding",{append:!0});break}}}return await((m=e.onFound)==null?void 0:m.call(e,c,s)),s.body(u)}await((h=e.onNotFound)==null?void 0:h.call(e,c,s)),await i()}},Ya=async(e,t)=>{let r;t&&t.manifest?typeof t.manifest=="string"?r=JSON.parse(t.manifest):r=t.manifest:typeof __STATIC_CONTENT_MANIFEST=="string"?r=JSON.parse(__STATIC_CONTENT_MANIFEST):r=__STATIC_CONTENT_MANIFEST;let a;t&&t.namespace?a=t.namespace:a=__STATIC_CONTENT;const s=r[e]||e;if(!s)return null;const i=await a.get(s,{type:"stream"});return i||null},Ja=e=>async function(r,a){return Ka({...e,getContent:async i=>Ya(i,{manifest:e.manifest,namespace:e.namespace?e.namespace:r.env?r.env.__STATIC_CONTENT:void 0})})(r,a)},Za=e=>Ja(e),Ue="_hp",Qa={Change:"Input",DoubleClick:"DblClick"},es={svg:"2000/svg",math:"1998/Math/MathML"},Le=[],xt=new WeakMap,Te=void 0,ts=()=>Te,X=e=>"t"in e,lt={onClick:["click",!1]},Pt=e=>{if(!e.startsWith("on"))return;if(lt[e])return lt[e];const t=e.match(/^on([A-Z][a-zA-Z]+?(?:PointerCapture)?)(Capture)?$/);if(t){const[,r,a]=t;return lt[e]=[(Qa[r]||r).toLowerCase(),!!a]}},$t=(e,t)=>Te&&e instanceof SVGElement&&/[A-Z]/.test(t)&&(t in e.style||t.match(/^(?:o|pai|str|u|ve)/))?t.replace(/([A-Z])/g,"-$1").toLowerCase():t,rs=(e,t,r)=>{var a;t||(t={});for(let s in t){const i=t[s];if(s!=="children"&&(!r||r[s]!==i)){s=et(s);const o=Pt(s);if(o){if((r==null?void 0:r[s])!==i&&(r&&e.removeEventListener(o[0],r[s],o[1]),i!=null)){if(typeof i!="function")throw new Error(`Event handler for "${s}" is not a function`);e.addEventListener(o[0],i,o[1])}}else if(s==="dangerouslySetInnerHTML"&&i)e.innerHTML=i.__html;else if(s==="ref"){let c;typeof i=="function"?c=i(e)||(()=>i(null)):i&&"current"in i&&(i.current=e,c=()=>i.current=null),xt.set(e,c)}else if(s==="style"){const c=e.style;typeof i=="string"?c.cssText=i:(c.cssText="",i!=null&&mr(i,c.setProperty.bind(c)))}else{if(s==="value"){const l=e.nodeName;if(l==="INPUT"||l==="TEXTAREA"||l==="SELECT"){if(e.value=i==null||i===!1?null:i,l==="TEXTAREA"){e.textContent=i;continue}else if(l==="SELECT"){e.selectedIndex===-1&&(e.selectedIndex=0);continue}}}else(s==="checked"&&e.nodeName==="INPUT"||s==="selected"&&e.nodeName==="OPTION")&&(e[s]=i);const c=$t(e,s);i==null||i===!1?e.removeAttribute(c):i===!0?e.setAttribute(c,""):typeof i=="string"||typeof i=="number"?e.setAttribute(c,i):e.setAttribute(c,i.toString())}}}if(r)for(let s in r){const i=r[s];if(s!=="children"&&!(s in t)){s=et(s);const o=Pt(s);o?e.removeEventListener(o[0],i,o[1]):s==="ref"?(a=xt.get(e))==null||a():e.removeAttribute($t(e,s))}}},as=(e,t)=>{t[A][0]=0,Le.push([e,t]);const r=t.tag[Et]||t.tag,a=r.defaultProps?{...r.defaultProps,...t.props}:t.props;try{return[r.call(null,a)]}finally{Le.pop()}},Dr=(e,t,r,a,s)=>{var i,o;(i=e.vR)!=null&&i.length&&(a.push(...e.vR),delete e.vR),typeof e.tag=="function"&&((o=e[A][1][Fr])==null||o.forEach(c=>s.push(c))),e.vC.forEach(c=>{var l;if(X(c))r.push(c);else if(typeof c.tag=="function"||c.tag===""){c.c=t;const u=r.length;if(Dr(c,t,r,a,s),c.s){for(let d=u;d<r.length;d++)r[d].s=!0;c.s=!1}}else r.push(c),(l=c.vR)!=null&&l.length&&(a.push(...c.vR),delete c.vR)})},ss=e=>{for(;;e=e.tag===Ue||!e.vC||!e.pP?e.nN:e.vC[0]){if(!e)return null;if(e.tag!==Ue&&e.e)return e.e}},Mr=e=>{var t,r,a,s,i,o;X(e)||((r=(t=e[A])==null?void 0:t[1][Fr])==null||r.forEach(c=>{var l;return(l=c[2])==null?void 0:l.call(c)}),(a=xt.get(e.e))==null||a(),e.p===2&&((s=e.vC)==null||s.forEach(c=>c.p=2)),(i=e.vC)==null||i.forEach(Mr)),e.p||((o=e.e)==null||o.remove(),delete e.e),typeof e.tag=="function"&&(Ae.delete(e),Je.delete(e),delete e[A][3],e.a=!0)},Ir=(e,t,r)=>{e.c=t,jr(e,t,r)},Bt=(e,t)=>{if(t){for(let r=0,a=e.length;r<a;r++)if(e[r]===t)return r}},Ht=Symbol(),jr=(e,t,r)=>{var u;const a=[],s=[],i=[];Dr(e,t,a,s,i),s.forEach(Mr);const o=r?void 0:t.childNodes;let c,l=null;if(r)c=-1;else if(!o.length)c=0;else{const d=Bt(o,ss(e.nN));d!==void 0?(l=o[d],c=d):c=Bt(o,(u=a.find(p=>p.tag!==Ue&&p.e))==null?void 0:u.e)??-1,c===-1&&(r=!0)}for(let d=0,p=a.length;d<p;d++,c++){const m=a[d];let h;if(m.s&&m.e)h=m.e,m.s=!1;else{const y=r||!m.e;X(m)?(m.e&&m.d&&(m.e.textContent=m.t),m.d=!1,h=m.e||(m.e=document.createTextNode(m.t))):(h=m.e||(m.e=m.n?document.createElementNS(m.n,m.tag):document.createElement(m.tag)),rs(h,m.props,m.pP),jr(m,h,y))}m.tag===Ue?c--:r?h.parentNode||t.appendChild(h):o[c]!==h&&o[c-1]!==h&&(o[c+1]===h?t.appendChild(o[c]):t.insertBefore(h,l||o[c]||null))}if(e.pP&&delete e.pP,i.length){const d=[],p=[];i.forEach(([,m,,h,y])=>{m&&d.push(m),h&&p.push(h),y==null||y()}),d.forEach(m=>m()),p.length&&requestAnimationFrame(()=>{p.forEach(m=>m())})}},ns=(e,t)=>!!(e&&e.length===t.length&&e.every((r,a)=>r[1]===t[a][1])),Je=new WeakMap,vt=(e,t,r)=>{var i,o,c,l,u,d;const a=!r&&t.pC;r&&(t.pC||(t.pC=t.vC));let s;try{r||(r=typeof t.tag=="function"?as(e,t):Pe(t.props.children)),((i=r[0])==null?void 0:i.tag)===""&&r[0][pt]&&(s=r[0][pt],e[5].push([e,s,t]));const p=a?[...t.pC]:t.vC?[...t.vC]:void 0,m=[];let h;for(let y=0;y<r.length;y++){Array.isArray(r[y])&&r.splice(y,1,...r[y].flat());let g=is(r[y]);if(g){typeof g.tag=="function"&&!g.tag[or]&&(Ne.length>0&&(g[A][2]=Ne.map(b=>[b,b.values.at(-1)])),(o=e[5])!=null&&o.length&&(g[A][3]=e[5].at(-1)));let x;if(p&&p.length){const b=p.findIndex(X(g)?T=>X(T):g.key!==void 0?T=>T.key===g.key&&T.tag===g.tag:T=>T.tag===g.tag);b!==-1&&(x=p[b],p.splice(b,1))}if(x)if(X(g))x.t!==g.t&&(x.t=g.t,x.d=!0),g=x;else{const b=x.pP=x.props;if(x.props=g.props,x.f||(x.f=g.f||t.f),typeof g.tag=="function"){const T=x[A][2];x[A][2]=g[A][2]||[],x[A][3]=g[A][3],!x.f&&((x.o||x)===g.o||(l=(c=x.tag)[Vr])!=null&&l.call(c,b,x.props))&&ns(T,x[A][2])&&(x.s=!0)}g=x}else if(!X(g)&&Te){const b=Re(Te);b&&(g.n=b)}if(!X(g)&&!g.s&&(vt(e,g),delete g.f),m.push(g),h&&!h.s&&!g.s)for(let b=h;b&&!X(b);b=(u=b.vC)==null?void 0:u.at(-1))b.nN=g;h=g}}t.vR=a?[...t.vC,...p||[]]:p||[],t.vC=m,a&&delete t.pC}catch(p){if(t.f=!0,p===Ht){if(s)return;throw p}const[m,h,y]=((d=t[A])==null?void 0:d[3])||[];if(h){const g=()=>Ze([0,!1,e[2]],y),x=Je.get(y)||[];x.push(g),Je.set(y,x);const b=h(p,()=>{const T=Je.get(y);if(T){const w=T.indexOf(g);if(w!==-1)return T.splice(w,1),g()}});if(b){if(e[0]===1)e[1]=!0;else if(vt(e,y,[b]),(h.length===1||e!==m)&&y.c){Ir(y,y.c,!1);return}throw Ht}}throw p}finally{s&&e[5].pop()}},is=e=>{if(!(e==null||typeof e=="boolean")){if(typeof e=="string"||typeof e=="number")return{t:e.toString(),d:!0};if("vR"in e&&(e={tag:e.tag,props:e.props,key:e.key,f:e.f,type:e.tag,ref:e.props.ref,o:e.o||e}),typeof e.tag=="function")e[A]=[0,[]];else{const t=es[e.tag];t&&(Te||(Te=lr("")),e.props.children=[{tag:Te,props:{value:e.n=`http://www.w3.org/${t}`,children:e.props.children}}])}return e}},Xt=(e,t)=>{var r,a;(r=t[A][2])==null||r.forEach(([s,i])=>{s.values.push(i)});try{vt(e,t,void 0)}catch{return}if(t.a){delete t.a;return}(a=t[A][2])==null||a.forEach(([s])=>{s.values.pop()}),(e[0]!==1||!e[1])&&Ir(t,t.c,!1)},Ae=new WeakMap,Gt=[],Ze=async(e,t)=>{e[5]||(e[5]=[]);const r=Ae.get(t);r&&r[0](void 0);let a;const s=new Promise(i=>a=i);if(Ae.set(t,[a,()=>{e[2]?e[2](e,t,i=>{Xt(i,t)}).then(()=>a(t)):(Xt(e,t),a(t))}]),Gt.length)Gt.at(-1).add(t);else{await Promise.resolve();const i=Ae.get(t);i&&(Ae.delete(t),i[1]())}return s},os=(e,t,r)=>({tag:Ue,props:{children:e},key:r,e:t,p:1}),dt=0,Fr=1,ut=2,mt=3,ft=new WeakMap,kr=(e,t)=>!e||!t||e.length!==t.length||t.some((r,a)=>r!==e[a]),cs=void 0,qt=[],ls=e=>{var o;const t=()=>typeof e=="function"?e():e,r=Le.at(-1);if(!r)return[t(),()=>{}];const[,a]=r,s=(o=a[A][1])[dt]||(o[dt]=[]),i=a[A][0]++;return s[i]||(s[i]=[t(),c=>{const l=cs,u=s[i];if(typeof c=="function"&&(c=c(u[0])),!Object.is(c,u[0]))if(u[0]=c,qt.length){const[d,p]=qt.at(-1);Promise.all([d===3?a:Ze([d,!1,l],a),p]).then(([m])=>{if(!m||!(d===2||d===3))return;const h=m.vC;requestAnimationFrame(()=>{setTimeout(()=>{h===m.vC&&Ze([d===3?1:0,!1,l],m)})})})}else Ze([0,!1,l],a)}])},Rt=(e,t)=>{var c;const r=Le.at(-1);if(!r)return e;const[,a]=r,s=(c=a[A][1])[ut]||(c[ut]=[]),i=a[A][0]++,o=s[i];return kr(o==null?void 0:o[1],t)?s[i]=[e,t]:e=s[i][0],e},ds=e=>{const t=ft.get(e);if(t){if(t.length===2)throw t[1];return t[0]}throw e.then(r=>ft.set(e,[r]),r=>ft.set(e,[void 0,r])),e},us=(e,t)=>{var c;const r=Le.at(-1);if(!r)return e();const[,a]=r,s=(c=a[A][1])[mt]||(c[mt]=[]),i=a[A][0]++,o=s[i];return kr(o==null?void 0:o[1],t)&&(s[i]=[e(),t]),s[i][0]},ms=lr({pending:!1,data:null,method:null,action:null}),zt=new Set,fs=e=>{zt.add(e),e.finally(()=>zt.delete(e))},wt=(e,t)=>us(()=>r=>{let a;e&&(typeof e=="function"?a=e(r)||(()=>{e(null)}):e&&"current"in e&&(e.current=r,a=()=>{e.current=null}));const s=t(r);return()=>{s==null||s(),a==null||a()}},[e]),fe=Object.create(null),Ge=Object.create(null),He=(e,t,r,a,s)=>{if(t!=null&&t.itemProp)return{tag:e,props:t,type:e,ref:t.ref};const i=document.head;let{onLoad:o,onError:c,precedence:l,blocking:u,...d}=t,p=null,m=!1;const h=qe[e];let y;if(h.length>0){const T=i.querySelectorAll(e);e:for(const w of T)for(const _ of qe[e])if(w.getAttribute(_)===t[_]){p=w;break e}if(!p){const w=h.reduce((_,L)=>t[L]===void 0?_:`${_}-${L}-${t[L]}`,e);m=!Ge[w],p=Ge[w]||(Ge[w]=(()=>{const _=document.createElement(e);for(const L of h)t[L]!==void 0&&_.setAttribute(L,t[L]),t.rel&&_.setAttribute("rel",t.rel);return _})())}}else y=i.querySelectorAll(e);l=a?l??"":void 0,a&&(d[ze]=l);const g=Rt(T=>{if(h.length>0){let w=!1;for(const _ of i.querySelectorAll(e)){if(w&&_.getAttribute(ze)!==l){i.insertBefore(T,_);return}_.getAttribute(ze)===l&&(w=!0)}i.appendChild(T)}else if(y){let w=!1;for(const _ of y)if(_===T){w=!0;break}w||i.insertBefore(T,i.contains(y[0])?y[0]:i.querySelector(e)),y=void 0}},[l]),x=wt(t.ref,T=>{var L;const w=h[0];if(r===2&&(T.innerHTML=""),(m||y)&&g(T),!c&&!o)return;let _=fe[L=T.getAttribute(w)]||(fe[L]=new Promise((ue,ae)=>{T.addEventListener("load",ue),T.addEventListener("error",ae)}));o&&(_=_.then(o)),c&&(_=_.catch(c)),_.catch(()=>{})});if(s&&u==="render"){const T=qe[e][0];if(t[T]){const w=t[T],_=fe[w]||(fe[w]=new Promise((L,ue)=>{g(p),p.addEventListener("load",L),p.addEventListener("error",ue)}));ds(_)}}const b={tag:e,type:e,props:{...d,ref:x},ref:x};return b.p=r,p&&(b.e=p),os(b,i)},ps=e=>{const t=ts(),r=t&&Re(t);return r!=null&&r.endsWith("svg")?{tag:"title",props:e,type:"title",ref:e.ref}:He("title",e,void 0,!1,!1)},hs=e=>!e||["src","async"].some(t=>!e[t])?{tag:"script",props:e,type:"script",ref:e.ref}:He("script",e,1,!1,!0),gs=e=>!e||!["href","precedence"].every(t=>t in e)?{tag:"style",props:e,type:"style",ref:e.ref}:(e["data-href"]=e.href,delete e.href,He("style",e,2,!0,!0)),ys=e=>!e||["onLoad","onError"].some(t=>t in e)||e.rel==="stylesheet"&&(!("precedence"in e)||"disabled"in e)?{tag:"link",props:e,type:"link",ref:e.ref}:He("link",e,1,"precedence"in e,!0),xs=e=>He("meta",e,void 0,!1,!1),Pr=Symbol(),vs=e=>{const{action:t,...r}=e;typeof t!="function"&&(r.action=t);const[a,s]=ls([null,!1]),i=Rt(async u=>{const d=u.isTrusted?t:u.detail[Pr];if(typeof d!="function")return;u.preventDefault();const p=new FormData(u.target);s([p,!0]);const m=d(p);m instanceof Promise&&(fs(m),await m),s([null,!0])},[]),o=wt(e.ref,u=>(u.addEventListener("submit",i),()=>{u.removeEventListener("submit",i)})),[c,l]=a;return a[1]=!1,{tag:ms,props:{value:{pending:c!==null,data:c,method:c?"post":null,action:c?t:null},children:{tag:"form",props:{...r,ref:o},type:"form",ref:o}},f:l}},$r=(e,{formAction:t,...r})=>{if(typeof t=="function"){const a=Rt(s=>{s.preventDefault(),s.currentTarget.form.dispatchEvent(new CustomEvent("submit",{detail:{[Pr]:t}}))},[]);r.ref=wt(r.ref,s=>(s.addEventListener("click",a),()=>{s.removeEventListener("click",a)}))}return{tag:e,props:r,type:e,ref:r.ref}},Es=e=>$r("input",e),bs=e=>$r("button",e);Object.assign(ht,{title:ps,script:hs,style:gs,link:ys,meta:xs,form:vs,input:Es,button:bs});bt(null);new TextEncoder;var Ns=bt(null),Ts=(e,t,r,a)=>(s,i)=>{const o="<!DOCTYPE html>",c=r?Lt(u=>r(u,e),{Layout:t,...i},s):s,l=zr`${j(o)}${Lt(Ns.Provider,{value:e},c)}`;return e.html(l)},_s=(e,t)=>function(a,s){const i=a.getLayout()??ia;return e&&a.setLayout(o=>e({...o,Layout:i},a)),a.setRenderer(Ts(a,i,e)),s()};const Rs=_s(({children:e})=>n("html",{lang:"es",children:[n("head",{children:[n("meta",{charset:"UTF-8"}),n("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),n("title",{children:"Lyra Expenses - Sistema de Gastos y Viáticos"}),n("script",{src:"https://cdn.tailwindcss.com"}),n("link",{href:"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css",rel:"stylesheet"}),n("link",{href:"/static/styles.css",rel:"stylesheet"}),n("script",{src:"https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"}),n("script",{src:"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"}),n("script",{src:"https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"}),n("meta",{name:"description",content:"Sistema ejecutivo de gestión de gastos y viáticos multiempresa con soporte multimoneda. Basado en el modelo 4-D: Dinero, Decisión, Dirección, Disciplina."}),n("meta",{name:"author",content:"Lyra - Asistente Estratégico"}),n("link",{rel:"icon",type:"image/x-icon",href:"data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBQAAFgAAACgAAAAQAAAAIAAAAAEACAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAA"})]}),n("body",{className:"bg-gray-100",children:[e,n("script",{src:"/static/app.js"})]})]})),S=new Ur;S.use("*",Ha());S.use("/api/*",ja());S.use(Rs);S.use("/static/*",Za({root:"./public"}));S.get("/api/health",async e=>{const{env:t}=e;try{const r=await t.DB.prepare("SELECT 1 as test").first();return e.json({status:"healthy",database:"connected",environment:t.ENVIRONMENT||"development",timestamp:new Date().toISOString()})}catch(r){return e.json({status:"unhealthy",database:"disconnected",error:r.message},500)}});S.post("/api/init-db",async e=>{const{env:t}=e;if(t.ENVIRONMENT==="production")return e.json({error:"Not available in production"},403);try{const r=[`CREATE TABLE IF NOT EXISTS companies (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        country TEXT NOT NULL CHECK (country IN ('MX', 'ES')), 
        logo_url TEXT,
        primary_currency TEXT NOT NULL DEFAULT 'MXN' CHECK (primary_currency IN ('MXN', 'EUR', 'USD')),
        tax_id TEXT,
        address TEXT,
        active BOOLEAN NOT NULL DEFAULT TRUE,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
      )`,`CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        email TEXT UNIQUE NOT NULL,
        name TEXT NOT NULL,
        password_hash TEXT NOT NULL,
        role TEXT NOT NULL DEFAULT 'editor' CHECK (role IN ('viewer', 'editor', 'advanced', 'admin')),
        active BOOLEAN NOT NULL DEFAULT TRUE,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        last_login DATETIME
      )`,`CREATE TABLE IF NOT EXISTS user_companies (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        user_id INTEGER NOT NULL,
        company_id INTEGER NOT NULL,
        can_view BOOLEAN NOT NULL DEFAULT TRUE,
        can_edit BOOLEAN NOT NULL DEFAULT FALSE,
        can_admin BOOLEAN NOT NULL DEFAULT FALSE,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        UNIQUE(user_id, company_id)
      )`,`CREATE TABLE IF NOT EXISTS expense_types (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        description TEXT,
        category TEXT NOT NULL DEFAULT 'general' CHECK (category IN ('travel', 'meals', 'transport', 'accommodation', 'supplies', 'services', 'general')),
        active BOOLEAN NOT NULL DEFAULT TRUE,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP
      )`,`CREATE TABLE IF NOT EXISTS expenses (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        company_id INTEGER NOT NULL,
        user_id INTEGER NOT NULL,
        expense_type_id INTEGER NOT NULL,
        description TEXT NOT NULL,
        expense_date DATE NOT NULL,
        amount DECIMAL(12,2) NOT NULL,
        currency TEXT NOT NULL CHECK (currency IN ('MXN', 'EUR', 'USD')),
        exchange_rate DECIMAL(10,6) NOT NULL DEFAULT 1.0,
        amount_mxn DECIMAL(12,2) NOT NULL,
        payment_method TEXT CHECK (payment_method IN ('cash', 'credit_card', 'debit_card', 'bank_transfer', 'company_card', 'petty_cash')),
        vendor TEXT,
        invoice_number TEXT,
        status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'rejected', 'reimbursed', 'invoiced')),
        approved_by INTEGER,
        approved_at DATETIME,
        notes TEXT,
        tags TEXT,
        is_billable BOOLEAN NOT NULL DEFAULT FALSE,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        created_by INTEGER NOT NULL,
        updated_by INTEGER
      )`,`CREATE TABLE IF NOT EXISTS attachments (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        expense_id INTEGER NOT NULL,
        file_name TEXT NOT NULL,
        file_type TEXT NOT NULL CHECK (file_type IN ('image', 'pdf', 'xml')),
        file_url TEXT NOT NULL,
        file_size INTEGER,
        mime_type TEXT,
        ocr_text TEXT,
        ocr_confidence DECIMAL(3,2),
        is_cfdi_valid BOOLEAN,
        cfdi_uuid TEXT,
        uploaded_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        uploaded_by INTEGER NOT NULL
      )`,`CREATE TABLE IF NOT EXISTS exchange_rates (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        from_currency TEXT NOT NULL CHECK (from_currency IN ('MXN', 'EUR', 'USD')),
        to_currency TEXT NOT NULL CHECK (to_currency IN ('MXN', 'EUR', 'USD')),
        rate DECIMAL(10,6) NOT NULL,
        rate_date DATE NOT NULL,
        source TEXT NOT NULL DEFAULT 'banxico',
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        UNIQUE(from_currency, to_currency, rate_date)
      )`];for(const a of r)await t.DB.prepare(a).run();return await t.DB.prepare(`
      INSERT OR IGNORE INTO companies (id, name, country, primary_currency, tax_id, active) VALUES 
        (1, 'TechMX Solutions', 'MX', 'MXN', 'TMX123456789', TRUE),
        (2, 'Innovación Digital MX', 'MX', 'MXN', 'IDM987654321', TRUE),
        (3, 'Consultoría Estratégica MX', 'MX', 'MXN', 'CEM555666777', TRUE),
        (4, 'TechES Barcelona', 'ES', 'EUR', 'B-12345678', TRUE),
        (5, 'Innovación Madrid SL', 'ES', 'EUR', 'B-87654321', TRUE),
        (6, 'Digital Valencia S.A.', 'ES', 'EUR', 'A-11223344', TRUE)
    `).run(),await t.DB.prepare(`
      INSERT OR IGNORE INTO expense_types (id, name, description, category, active) VALUES 
        (1, 'Comidas de Trabajo', 'Gastos en restaurantes por reuniones de trabajo', 'meals', TRUE),
        (2, 'Transporte Terrestre', 'Taxis, Uber, autobuses, metro', 'transport', TRUE),
        (3, 'Combustible', 'Gasolina y gastos de vehículos', 'transport', TRUE),
        (4, 'Hospedaje', 'Hoteles y alojamientos', 'accommodation', TRUE),
        (5, 'Vuelos', 'Boletos de avión nacionales e internacionales', 'travel', TRUE),
        (6, 'Material de Oficina', 'Papelería, suministros de oficina', 'supplies', TRUE),
        (7, 'Software y Licencias', 'Suscripciones y licencias de software', 'services', TRUE),
        (8, 'Capacitación', 'Cursos, conferencias, workshops', 'services', TRUE),
        (9, 'Marketing', 'Publicidad, eventos, promociones', 'services', TRUE),
        (10, 'Otros Gastos', 'Gastos diversos no categorizados', 'general', TRUE)
    `).run(),await t.DB.prepare(`
      INSERT OR IGNORE INTO users (id, email, name, password_hash, role, active) VALUES 
        (1, 'admin@techmx.com', 'Alejandro Rodríguez', '$2b$10$example_hash_admin', 'admin', TRUE),
        (2, 'maria.lopez@techmx.com', 'María López', '$2b$10$example_hash_user1', 'editor', TRUE),
        (3, 'carlos.martinez@innovacion.mx', 'Carlos Martínez', '$2b$10$example_hash_user2', 'advanced', TRUE),
        (4, 'ana.garcia@consultoria.mx', 'Ana García', '$2b$10$example_hash_user3', 'editor', TRUE),
        (5, 'pedro.sanchez@techespana.es', 'Pedro Sánchez', '$2b$10$example_hash_user4', 'advanced', TRUE),
        (6, 'elena.torres@madrid.es', 'Elena Torres', '$2b$10$example_hash_user5', 'editor', TRUE)
    `).run(),await t.DB.prepare(`
      INSERT OR IGNORE INTO user_companies (user_id, company_id, can_view, can_edit, can_admin) VALUES 
        (1, 1, TRUE, TRUE, TRUE), (1, 2, TRUE, TRUE, TRUE), (1, 3, TRUE, TRUE, TRUE),
        (1, 4, TRUE, TRUE, TRUE), (1, 5, TRUE, TRUE, TRUE), (1, 6, TRUE, TRUE, TRUE),
        (2, 1, TRUE, TRUE, FALSE), (3, 2, TRUE, TRUE, FALSE), (4, 3, TRUE, TRUE, FALSE),
        (5, 4, TRUE, TRUE, FALSE), (6, 5, TRUE, TRUE, FALSE)
    `).run(),await t.DB.prepare(`
      INSERT OR IGNORE INTO exchange_rates (from_currency, to_currency, rate, rate_date, source) VALUES 
        ('USD', 'MXN', 18.25, '2024-09-24', 'banxico'),
        ('EUR', 'MXN', 20.15, '2024-09-24', 'banxico'),
        ('EUR', 'USD', 1.10, '2024-09-24', 'ecb'),
        ('USD', 'EUR', 0.91, '2024-09-24', 'ecb'),
        ('MXN', 'USD', 0.055, '2024-09-24', 'banxico'),
        ('MXN', 'EUR', 0.050, '2024-09-24', 'banxico')
    `).run(),await t.DB.prepare(`
      INSERT OR IGNORE INTO expenses (
        id, company_id, user_id, expense_type_id, description, expense_date, 
        amount, currency, exchange_rate, amount_mxn, payment_method, vendor, 
        status, notes, is_billable, created_by
      ) VALUES 
        (1, 1, 2, 1, 'Comida con cliente - Proyecto Alpha', '2024-09-20', 850.00, 'MXN', 1.0, 850.00, 'company_card', 'Restaurante Pujol', 'approved', 'Reunión de cierre de proyecto', TRUE, 2),
        (2, 1, 2, 2, 'Taxi al aeropuerto', '2024-09-21', 320.50, 'MXN', 1.0, 320.50, 'cash', 'Uber', 'pending', NULL, FALSE, 2),
        (3, 2, 3, 7, 'Licencia Adobe Creative Suite', '2024-09-22', 2500.00, 'MXN', 1.0, 2500.00, 'credit_card', 'Adobe Inc', 'approved', 'Renovación anual', FALSE, 3),
        (4, 4, 5, 5, 'Vuelo Barcelona-Madrid', '2024-09-18', 120.00, 'EUR', 20.15, 2418.00, 'company_card', 'Iberia', 'reimbursed', 'Reunión con cliente en Madrid', TRUE, 5),
        (5, 5, 6, 4, 'Hotel NH Collection Madrid', '2024-09-19', 180.00, 'EUR', 20.15, 3627.00, 'credit_card', 'NH Hotels', 'approved', 'Estadía 2 noches', TRUE, 6),
        (6, 1, 1, 8, 'Conferencia AWS Re:Invent', '2024-09-15', 1500.00, 'USD', 18.25, 27375.00, 'company_card', 'Amazon Web Services', 'approved', 'Capacitación en cloud computing', FALSE, 1),
        (7, 3, 4, 6, 'Material de oficina importado', '2024-09-23', 250.00, 'USD', 18.25, 4562.50, 'bank_transfer', 'Office Depot USA', 'pending', 'Material especializado', FALSE, 4)
    `).run(),e.json({success:!0,message:"Base de datos inicializada con datos de prueba",timestamp:new Date().toISOString()})}catch(r){return e.json({error:"Failed to initialize database",details:r.message},500)}});S.get("/api/companies",async e=>{const{env:t}=e;try{const r=await t.DB.prepare(`
      SELECT id, name, country, primary_currency, logo_url, active, created_at
      FROM companies 
      WHERE active = TRUE
      ORDER BY country, name
    `).all();return e.json({companies:r.results})}catch{return e.json({error:"Failed to fetch companies"},500)}});S.get("/api/users",async e=>{const{env:t}=e;try{const r=await t.DB.prepare(`
      SELECT u.id, u.email, u.name, u.role, u.active, u.created_at,
             GROUP_CONCAT(c.name, '|') as companies
      FROM users u
      LEFT JOIN user_companies uc ON u.id = uc.user_id
      LEFT JOIN companies c ON uc.company_id = c.id
      WHERE u.active = TRUE
      GROUP BY u.id
      ORDER BY u.name
    `).all();return e.json({users:r.results})}catch{return e.json({error:"Failed to fetch users"},500)}});S.get("/api/expenses",async e=>{const{env:t}=e,r=e.req.query();let a=`
    SELECT e.*, c.name as company_name, u.name as user_name, et.name as expense_type_name,
           c.country, c.primary_currency as company_currency
    FROM expenses e
    JOIN companies c ON e.company_id = c.id
    JOIN users u ON e.user_id = u.id
    JOIN expense_types et ON e.expense_type_id = et.id
    WHERE 1=1
  `;const s=[];r.company_id&&(a+=" AND e.company_id = ?",s.push(r.company_id)),r.user_id&&(a+=" AND e.user_id = ?",s.push(r.user_id)),r.status&&(a+=" AND e.status = ?",s.push(r.status)),r.currency&&(a+=" AND e.currency = ?",s.push(r.currency)),r.date_from&&(a+=" AND e.expense_date >= ?",s.push(r.date_from)),r.date_to&&(a+=" AND e.expense_date <= ?",s.push(r.date_to)),a+=" ORDER BY e.expense_date DESC, e.created_at DESC",r.limit&&(a+=" LIMIT ?",s.push(parseInt(r.limit)||50));try{const o=await t.DB.prepare(a).bind(...s).all();return e.json({expenses:o.results,total:o.results.length})}catch{return e.json({error:"Failed to fetch expenses"},500)}});S.post("/api/expenses",async e=>{const{env:t}=e;try{const r=await e.req.json(),a=["company_id","expense_type_id","description","expense_date","amount","currency"];for(const c of a)if(!r[c])return e.json({error:`Missing required field: ${c}`},400);let s=r.amount,i=1;r.currency==="USD"?(i=18.25,s=r.amount*i):r.currency==="EUR"&&(i=20.15,s=r.amount*i);const o=await t.DB.prepare(`
      INSERT INTO expenses (
        company_id, user_id, expense_type_id, description, expense_date, 
        amount, currency, exchange_rate, amount_mxn, payment_method, 
        vendor, notes, status, created_by
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).bind(r.company_id,r.user_id||1,r.expense_type_id,r.description,r.expense_date,r.amount,r.currency,i,s,r.payment_method||"cash",r.vendor||"",r.notes||"","pending",r.user_id||1).run();return e.json({success:!0,expense_id:o.meta.last_row_id,message:"Gasto creado exitosamente"})}catch(r){return e.json({error:"Failed to create expense",details:r.message},500)}});S.get("/api/dashboard/metrics",async e=>{const{env:t}=e;e.req.query();try{const r=await t.DB.prepare(`
      SELECT status, COUNT(*) as count, SUM(amount_mxn) as total_mxn
      FROM expenses
      GROUP BY status
    `).all(),a=await t.DB.prepare(`
      SELECT c.name as company, c.country, COUNT(*) as count, SUM(e.amount_mxn) as total_mxn
      FROM expenses e
      JOIN companies c ON e.company_id = c.id
      GROUP BY c.id, c.name, c.country
      ORDER BY total_mxn DESC
    `).all(),s=await t.DB.prepare(`
      SELECT currency, COUNT(*) as count, SUM(amount) as total_original, SUM(amount_mxn) as total_mxn
      FROM expenses
      GROUP BY currency
    `).all(),i=await t.DB.prepare(`
      SELECT e.*, c.name as company_name, u.name as user_name
      FROM expenses e
      JOIN companies c ON e.company_id = c.id
      JOIN users u ON e.user_id = u.id
      ORDER BY e.created_at DESC
      LIMIT 10
    `).all();return e.json({status_metrics:r.results,company_metrics:a.results,currency_metrics:s.results,recent_expenses:i.results})}catch{return e.json({error:"Failed to fetch dashboard metrics"},500)}});S.get("/api/expense-types",async e=>{const{env:t}=e;try{const r=await t.DB.prepare(`
      SELECT id, name, description, category, active
      FROM expense_types
      WHERE active = TRUE
      ORDER BY category, name
    `).all();return e.json({expense_types:r.results})}catch{return e.json({error:"Failed to fetch expense types"},500)}});S.get("/api/exchange-rates",async e=>{const{env:t}=e,r=e.req.query();try{const a=await t.DB.prepare(`
      SELECT from_currency, to_currency, rate, rate_date, source
      FROM exchange_rates
      WHERE rate_date = (
        SELECT MAX(rate_date) FROM exchange_rates
      )
      ORDER BY from_currency, to_currency
    `).all();if(r.from&&r.to){const s=a.results.find(i=>i.from_currency===r.from&&i.to_currency===r.to);if(s)return e.json({rate:s.rate,date:s.rate_date,source:s.source});{const i=a.results.find(o=>o.from_currency===r.to&&o.to_currency===r.from);if(i)return e.json({rate:(1/i.rate).toFixed(6),date:i.rate_date,source:i.source+" (inverse)"})}return e.json({error:"Exchange rate not found"},404)}return e.json({exchange_rates:a.results})}catch{return e.json({error:"Failed to fetch exchange rates"},500)}});S.post("/api/exchange-rates/update",async e=>{const{env:t}=e;try{const r=new Date().toISOString().split("T")[0],a=[{from:"USD",to:"MXN",rate:18.25,source:"banxico"},{from:"EUR",to:"MXN",rate:20.15,source:"banxico"},{from:"EUR",to:"USD",rate:1.1,source:"ecb"},{from:"USD",to:"EUR",rate:.91,source:"ecb"},{from:"MXN",to:"USD",rate:.055,source:"banxico"},{from:"MXN",to:"EUR",rate:.05,source:"banxico"}];for(const s of a)await t.DB.prepare(`
        INSERT OR REPLACE INTO exchange_rates 
        (from_currency, to_currency, rate, rate_date, source, created_at)
        VALUES (?, ?, ?, ?, ?, CURRENT_TIMESTAMP)
      `).bind(s.from,s.to,s.rate,r,s.source).run();return e.json({success:!0,message:"Exchange rates updated successfully",date:r})}catch{return e.json({error:"Failed to update exchange rates"},500)}});S.post("/api/attachments",async e=>{const{env:t}=e;try{const r=await e.req.formData(),a=r.get("file"),s=r.get("expense_id");if(!a||!s)return e.json({error:"File and expense_id are required"},400);const i=`/uploads/${Date.now()}-${a.name}`,o=await t.DB.prepare(`
      INSERT INTO attachments (
        expense_id, file_name, file_type, file_url, file_size, 
        mime_type, uploaded_by, uploaded_at
      ) VALUES (?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)
    `).bind(s,a.name,a.type.startsWith("image/")?"image":a.type==="application/pdf"?"pdf":"xml",i,a.size,a.type,1).run();return e.json({success:!0,attachment_id:o.meta.last_row_id,file_url:i,message:"File uploaded successfully"})}catch{return e.json({error:"Failed to upload attachment"},500)}});S.get("/api/expenses/:id/attachments",async e=>{const{env:t}=e,r=e.req.param("id");try{const a=await t.DB.prepare(`
      SELECT id, file_name, file_type, file_url, file_size, 
             mime_type, ocr_text, uploaded_at
      FROM attachments
      WHERE expense_id = ?
      ORDER BY uploaded_at ASC
    `).bind(r).all();return e.json({attachments:a.results})}catch{return e.json({error:"Failed to fetch attachments"},500)}});S.post("/api/reports/pdf",async e=>{const{env:t}=e;try{const r=await e.req.json(),{company_id:a,date_from:s,date_to:i,status:o,currency:c,user_id:l,expense_type_id:u,format:d="detailed"}=r;let p=`
      SELECT e.*, c.name as company_name, c.country, c.logo_url, c.primary_currency,
             u.name as user_name, et.name as expense_type_name, et.category,
             COUNT(a.id) as attachments_count
      FROM expenses e
      JOIN companies c ON e.company_id = c.id
      JOIN users u ON e.user_id = u.id
      JOIN expense_types et ON e.expense_type_id = et.id
      LEFT JOIN attachments a ON e.id = a.expense_id
      WHERE 1=1
    `;const m=[];a&&(p+=" AND e.company_id = ?",m.push(a)),s&&(p+=" AND e.expense_date >= ?",m.push(s)),i&&(p+=" AND e.expense_date <= ?",m.push(i)),o&&(p+=" AND e.status = ?",m.push(o)),c&&(p+=" AND e.currency = ?",m.push(c)),l&&(p+=" AND e.user_id = ?",m.push(l)),u&&(p+=" AND e.expense_type_id = ?",m.push(u)),p+=" GROUP BY e.id ORDER BY e.expense_date DESC, e.created_at DESC";const h=await t.DB.prepare(p).bind(...m).all();let y=null;a&&(y=await t.DB.prepare("SELECT * FROM companies WHERE id = ?").bind(a).first());const g=ws(h.results,y,d,{date_from:s,date_to:i,status:o,currency:c});return e.json({success:!0,html_content:g,total_expenses:h.results.length,total_amount:h.results.reduce((x,b)=>x+parseFloat(b.amount_mxn||0),0),filters:{company_id:a,date_from:s,date_to:i,status:o,currency:c,user_id:l,expense_type_id:u},message:"PDF content generated successfully"})}catch(r){return e.json({error:"Failed to generate PDF report",details:r.message},500)}});S.post("/api/reports/excel",async e=>{const{env:t}=e;try{const a=await e.req.json();let s=`
      SELECT e.id, e.description, e.expense_date, e.amount, e.currency, e.exchange_rate, 
             e.amount_mxn, e.payment_method, e.vendor, e.invoice_number, e.status, e.notes,
             e.is_billable, e.created_at,
             c.name as company_name, c.country, c.primary_currency,
             u.name as user_name, u.email as user_email,
             et.name as expense_type_name, et.category
      FROM expenses e
      JOIN companies c ON e.company_id = c.id
      JOIN users u ON e.user_id = u.id
      JOIN expense_types et ON e.expense_type_id = et.id
      WHERE 1=1
    `;const i=[];a.company_id&&(s+=" AND e.company_id = ?",i.push(a.company_id)),a.date_from&&(s+=" AND e.expense_date >= ?",i.push(a.date_from)),a.date_to&&(s+=" AND e.expense_date <= ?",i.push(a.date_to)),a.status&&(s+=" AND e.status = ?",i.push(a.status)),s+=" ORDER BY e.expense_date DESC";const o=await t.DB.prepare(s).bind(...i).all();return e.json({success:!0,data:o.results,total_records:o.results.length,total_amount_mxn:o.results.reduce((c,l)=>c+parseFloat(l.amount_mxn||0),0),export_date:new Date().toISOString(),filters:a})}catch(r){return e.json({error:"Failed to generate Excel export",details:r.message},500)}});S.post("/api/import/excel",async e=>{const{env:t}=e;try{const r=await e.req.json(),{data:a,mappings:s,company_id:i,user_id:o=1}=r;if(!a||!Array.isArray(a)||!s)return e.json({error:"Data and column mappings are required"},400);const c={total:a.length,imported:0,errors:[],skipped:0};for(let l=0;l<a.length;l++){const u=a[l];try{const d={company_id:i||H(u,s.company_id),expense_type_id:H(u,s.expense_type_id)||10,description:H(u,s.description)||"Importado desde Excel",expense_date:H(u,s.expense_date)||new Date().toISOString().split("T")[0],amount:parseFloat(H(u,s.amount))||0,currency:H(u,s.currency)||"MXN",payment_method:H(u,s.payment_method)||"cash",vendor:H(u,s.vendor)||"",notes:H(u,s.notes)||"Importado desde Excel",status:"pending",user_id:o,created_by:o};let p=1,m=d.amount;d.currency==="USD"?(p=18.25,m=d.amount*p):d.currency==="EUR"&&(p=20.15,m=d.amount*p);const h=await t.DB.prepare(`
          INSERT INTO expenses (
            company_id, user_id, expense_type_id, description, expense_date, 
            amount, currency, exchange_rate, amount_mxn, payment_method, 
            vendor, notes, status, created_by, created_at
          ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)
        `).bind(d.company_id,d.user_id,d.expense_type_id,d.description,d.expense_date,d.amount,d.currency,p,m,d.payment_method,d.vendor,d.notes,d.status,d.created_by).run();c.imported++}catch(d){c.errors.push({row:l+1,error:d.message,data:u})}}return e.json({success:!0,results:c,message:`Importación completada: ${c.imported} gastos importados, ${c.errors.length} errores`})}catch(r){return e.json({error:"Failed to import Excel data",details:r.message},500)}});function H(e,t){return t&&e[t]||null}function ws(e,t,r,a){const s=new Date().toLocaleDateString("es-MX"),i=(t==null?void 0:t.name)||"Consolidado",o=(t==null?void 0:t.country)==="MX"?"🇲🇽":(t==null?void 0:t.country)==="ES"?"🇪🇸":"🌍";let c=`
    <!DOCTYPE html>
    <html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Reporte de Gastos - ${i}</title>
        <style>
            body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
            .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px; }
            .logo { width: 80px; height: 80px; margin: 0 auto 10px; background: #3B82F6; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: bold; }
            .company-info { margin: 10px 0; }
            .filters { background: #F3F4F6; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
            .summary { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 30px; }
            .summary-card { background: #F9FAFB; padding: 15px; border-radius: 5px; text-align: center; border: 1px solid #E5E7EB; }
            .summary-number { font-size: 24px; font-weight: bold; color: #1F2937; }
            .summary-label { font-size: 12px; color: #6B7280; margin-top: 5px; }
            table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
            th, td { padding: 10px; text-align: left; border-bottom: 1px solid #E5E7EB; }
            th { background: #F9FAFB; font-weight: bold; }
            .currency-mxn { color: #059669; }
            .currency-usd { color: #3B82F6; }
            .currency-eur { color: #8B5CF6; }
            .status-pending { background: #FEF3C7; color: #92400E; padding: 2px 6px; border-radius: 12px; font-size: 11px; }
            .status-approved { background: #D1FAE5; color: #065F46; padding: 2px 6px; border-radius: 12px; font-size: 11px; }
            .status-rejected { background: #FEE2E2; color: #991B1B; padding: 2px 6px; border-radius: 12px; font-size: 11px; }
            .status-reimbursed { background: #DBEAFE; color: #1E40AF; padding: 2px 6px; border-radius: 12px; font-size: 11px; }
            .footer { text-align: center; margin-top: 40px; font-size: 12px; color: #6B7280; border-top: 1px solid #E5E7EB; padding-top: 20px; }
            @media print { body { margin: 0; } }
        </style>
    </head>
    <body>
        <div class="header">
            <div class="logo">${i.substring(0,2).toUpperCase()}</div>
            <h1>${o} ${i}</h1>
            <h2>Reporte de Gastos y Viáticos</h2>
            <p class="company-info">Sistema Lyra Expenses • Modelo 4-D</p>
        </div>
        
        <div class="filters">
            <h3>Filtros Aplicados:</h3>
            <p><strong>Período:</strong> ${a.date_from||"Inicio"} - ${a.date_to||"Actual"}</p>
            ${a.status?`<p><strong>Estado:</strong> ${a.status}</p>`:""}
            ${a.currency?`<p><strong>Moneda:</strong> ${a.currency}</p>`:""}
            <p><strong>Fecha de generación:</strong> ${s}</p>
        </div>
  `;const l=e.reduce((m,h)=>m+parseFloat(h.amount_mxn||0),0),u=e.length,d=e.filter(m=>m.status==="pending").length,p=e.reduce((m,h)=>(m[h.currency]=(m[h.currency]||0)+parseFloat(h.amount||0),m),{});return c+=`
    <div class="summary">
        <div class="summary-card">
            <div class="summary-number">${u}</div>
            <div class="summary-label">Total Gastos</div>
        </div>
        <div class="summary-card">
            <div class="summary-number">$${l.toLocaleString("es-MX",{minimumFractionDigits:2})}</div>
            <div class="summary-label">Total MXN</div>
        </div>
        <div class="summary-card">
            <div class="summary-number">${d}</div>
            <div class="summary-label">Pendientes</div>
        </div>
        <div class="summary-card">
            <div class="summary-number">${Object.keys(p).length}</div>
            <div class="summary-label">Monedas</div>
        </div>
    </div>
  `,c+=`
    <table>
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Descripción</th>
                <th>Usuario</th>
                <th>Tipo</th>
                <th>Monto Original</th>
                <th>Monto MXN</th>
                <th>Estado</th>
                <th>Método Pago</th>
            </tr>
        </thead>
        <tbody>
  `,e.forEach(m=>{c+=`
      <tr>
          <td>${new Date(m.expense_date).toLocaleDateString("es-MX")}</td>
          <td>${m.description}</td>
          <td>${m.user_name}</td>
          <td>${m.expense_type_name}</td>
          <td class="currency-${m.currency.toLowerCase()}">${m.currency} $${parseFloat(m.amount).toLocaleString("es-MX",{minimumFractionDigits:2})}</td>
          <td class="currency-mxn">MXN $${parseFloat(m.amount_mxn).toLocaleString("es-MX",{minimumFractionDigits:2})}</td>
          <td><span class="status-${m.status}">${As(m.status)}</span></td>
          <td>${Ss(m.payment_method)}</td>
      </tr>
    `}),c+=`
        </tbody>
    </table>
    
    <div class="footer">
        <p>Lyra Expenses - Sistema de Gestión de Gastos y Viáticos</p>
        <p>Modelo 4-D: Dinero • Decisión • Dirección • Disciplina</p>
        <p>Generado el ${s} • Total de registros: ${u}</p>
    </div>
    </body>
    </html>
  `,c}function As(e){return{pending:"Pendiente",approved:"Aprobado",rejected:"Rechazado",reimbursed:"Reembolsado",invoiced:"Facturado"}[e]||e}function Ss(e){return{cash:"Efectivo",credit_card:"Tarjeta de Crédito",debit_card:"Tarjeta de Débito",bank_transfer:"Transferencia",company_card:"Tarjeta Empresarial",petty_cash:"Caja Chica"}[e]||e}S.get("/",e=>e.render(n("div",{className:"min-h-screen bg-gray-100",children:[n("div",{className:"bg-white shadow-sm border-b",children:n("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:n("div",{className:"flex justify-between items-center py-6",children:[n("div",{className:"flex items-center space-x-4",children:[n("i",{className:"fas fa-calculator text-blue-600 text-2xl"}),n("h1",{className:"text-2xl font-bold text-gray-900",children:"Lyra Expenses"}),n("span",{className:"bg-blue-100 text-blue-800 text-xs px-2.5 py-0.5 rounded-full",children:"Sistema 4-D: Dinero, Decisión, Dirección, Disciplina"})]}),n("div",{className:"flex items-center space-x-4",children:[n("select",{id:"currency-selector",className:"border border-gray-300 rounded-lg px-3 py-2 text-sm",children:[n("option",{value:"MXN",children:"Ver en MXN 🇲🇽"}),n("option",{value:"USD",children:"Ver en USD 🇺🇸"}),n("option",{value:"EUR",children:"Ver en EUR 🇪🇺"})]}),n("button",{onclick:"showExpenseForm()",className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:[n("i",{className:"fas fa-plus mr-2"}),"Nuevo Gasto"]}),n("a",{href:"/expenses",className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[n("i",{className:"fas fa-list mr-2"}),"Ver Todos"]})]})]})})}),n("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:n("div",{id:"app",children:[n("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[n("div",{className:"bg-gradient-to-r from-green-500 to-green-600 p-6 rounded-lg shadow-sm text-white",children:n("div",{className:"flex items-center",children:[n("div",{className:"flex-shrink-0",children:n("i",{className:"fas fa-money-bill-wave text-3xl"})}),n("div",{className:"ml-4",children:[n("p",{className:"text-sm font-medium opacity-90",children:"Total Gastos"}),n("p",{className:"text-2xl font-bold",id:"total-expenses",children:"$0"}),n("p",{className:"text-xs opacity-75",id:"total-expenses-period",children:"Este mes"})]})]})}),n("div",{className:"bg-gradient-to-r from-yellow-500 to-yellow-600 p-6 rounded-lg shadow-sm text-white",children:n("div",{className:"flex items-center",children:[n("div",{className:"flex-shrink-0",children:n("i",{className:"fas fa-clock text-3xl"})}),n("div",{className:"ml-4",children:[n("p",{className:"text-sm font-medium opacity-90",children:"Pendientes"}),n("p",{className:"text-2xl font-bold",id:"pending-expenses",children:"0"}),n("p",{className:"text-xs opacity-75",children:"Por aprobar"})]})]})}),n("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 p-6 rounded-lg shadow-sm text-white",children:n("div",{className:"flex items-center",children:[n("div",{className:"flex-shrink-0",children:n("i",{className:"fas fa-building text-3xl"})}),n("div",{className:"ml-4",children:[n("p",{className:"text-sm font-medium opacity-90",children:"Empresas Activas"}),n("p",{className:"text-2xl font-bold",id:"companies-count",children:"0"}),n("p",{className:"text-xs opacity-75",children:"MX + ES"})]})]})}),n("div",{className:"bg-gradient-to-r from-purple-500 to-purple-600 p-6 rounded-lg shadow-sm text-white",children:n("div",{className:"flex items-center",children:[n("div",{className:"flex-shrink-0",children:n("i",{className:"fas fa-users text-3xl"})}),n("div",{className:"ml-4",children:[n("p",{className:"text-sm font-medium opacity-90",children:"Usuarios"}),n("p",{className:"text-2xl font-bold",id:"users-count",children:"0"}),n("p",{className:"text-xs opacity-75",children:"Multirol"})]})]})})]}),n("div",{className:"mb-8",children:[n("div",{className:"flex justify-between items-center mb-6",children:[n("h2",{className:"text-xl font-bold text-gray-900",children:[n("i",{className:"fas fa-th-large mr-2 text-blue-600"}),"Empresas - Acceso Directo"]}),n("button",{onclick:"toggleCompanyView()",className:"text-blue-600 hover:text-blue-800 text-sm",children:[n("i",{className:"fas fa-expand mr-1"}),"Vista Expandida"]})]}),n("div",{id:"companies-mosaic",className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"})]}),n("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[n("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[n("div",{className:"flex justify-between items-center mb-4",children:[n("h3",{className:"text-lg font-semibold text-gray-900",children:[n("i",{className:"fas fa-chart-pie mr-2 text-blue-600"}),"Gastos por Empresa"]}),n("select",{id:"period-selector",className:"text-sm border border-gray-300 rounded px-2 py-1",children:[n("option",{value:"month",children:"Este Mes"}),n("option",{value:"quarter",children:"Trimestre"}),n("option",{value:"year",children:"Este Año"})]})]}),n("div",{id:"company-chart",className:"h-64"})]}),n("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[n("div",{className:"flex justify-between items-center mb-4",children:[n("h3",{className:"text-lg font-semibold text-gray-900",children:[n("i",{className:"fas fa-coins mr-2 text-green-600"}),"Distribución por Moneda"]}),n("div",{className:"text-xs text-gray-500",children:"Tipos de cambio actualizados"})]}),n("div",{id:"currency-chart",className:"h-64"})]})]}),n("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[n("div",{className:"bg-white rounded-lg shadow-sm border",children:[n("div",{className:"px-6 py-4 border-b",children:n("h3",{className:"text-lg font-semibold text-gray-900",children:[n("i",{className:"fas fa-receipt mr-2 text-orange-600"}),"Actividad Reciente"]})}),n("div",{className:"p-6",children:n("div",{id:"recent-activity",className:"space-y-4"})})]}),n("div",{className:"bg-white rounded-lg shadow-sm border",children:[n("div",{className:"px-6 py-4 border-b",children:n("h3",{className:"text-lg font-semibold text-gray-900",children:[n("i",{className:"fas fa-exclamation-triangle mr-2 text-yellow-600"}),"Acciones Requeridas"]})}),n("div",{className:"p-6",children:n("div",{id:"pending-actions",className:"space-y-4"})})]})]}),n("div",{className:"bg-white rounded-lg shadow-sm border",children:[n("div",{className:"px-6 py-4 border-b",children:n("div",{className:"flex justify-between items-center",children:[n("h3",{className:"text-lg font-semibold text-gray-900",children:[n("i",{className:"fas fa-table mr-2 text-gray-600"}),"Últimos Gastos Registrados"]}),n("a",{href:"/expenses",className:"text-blue-600 hover:text-blue-800 text-sm",children:"Ver todos los gastos →"})]})}),n("div",{className:"overflow-x-auto",children:n("table",{className:"min-w-full divide-y divide-gray-200",children:[n("thead",{className:"bg-gray-50",children:n("tr",{children:[n("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),n("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empresa"}),n("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Usuario"}),n("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monto"}),n("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),n("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),n("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Adjuntos"})]})}),n("tbody",{id:"recent-expenses-table",className:"bg-white divide-y divide-gray-200",children:n("tr",{children:n("td",{colspan:"7",className:"px-6 py-4 text-center text-gray-500",children:[n("i",{className:"fas fa-spinner fa-spin mr-2"}),"Cargando gastos recientes..."]})})})]})})]})]})})]})));S.get("/expenses",e=>e.render(n("div",{className:"min-h-screen bg-gray-100",children:[n("div",{className:"bg-white shadow-sm border-b",children:n("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:n("div",{className:"flex justify-between items-center py-6",children:[n("div",{className:"flex items-center space-x-4",children:[n("a",{href:"/",className:"text-blue-600 hover:text-blue-700",children:n("i",{className:"fas fa-arrow-left"})}),n("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Gastos"})]}),n("div",{className:"flex items-center space-x-4",children:[n("button",{className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",onclick:"showExpenseForm()",children:[n("i",{className:"fas fa-plus mr-2"}),"Registrar Gasto"]}),n("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",onclick:"showImportExcel()",children:[n("i",{className:"fas fa-file-excel mr-2"}),"Importar Excel"]})]})]})})}),n("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[n("div",{className:"bg-white p-6 rounded-lg shadow-sm border mb-6",children:[n("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Filtros Avanzados"}),n("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Empresa"}),n("select",{id:"filter-company",className:"w-full border border-gray-300 rounded-lg px-3 py-2",children:n("option",{value:"",children:"Todas las empresas"})})]}),n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Usuario"}),n("select",{id:"filter-user",className:"w-full border border-gray-300 rounded-lg px-3 py-2",children:n("option",{value:"",children:"Todos los usuarios"})})]}),n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estado"}),n("select",{id:"filter-status",className:"w-full border border-gray-300 rounded-lg px-3 py-2",children:[n("option",{value:"",children:"Todos los estados"}),n("option",{value:"pending",children:"Pendiente"}),n("option",{value:"approved",children:"Aprobado"}),n("option",{value:"rejected",children:"Rechazado"}),n("option",{value:"reimbursed",children:"Reembolsado"}),n("option",{value:"invoiced",children:"Facturado"})]})]}),n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Moneda"}),n("select",{id:"filter-currency",className:"w-full border border-gray-300 rounded-lg px-3 py-2",children:[n("option",{value:"",children:"Todas las monedas"}),n("option",{value:"MXN",children:"🇲🇽 MXN"}),n("option",{value:"USD",children:"🇺🇸 USD"}),n("option",{value:"EUR",children:"🇪🇺 EUR"})]})]}),n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Gasto"}),n("select",{id:"filter-expense-type",className:"w-full border border-gray-300 rounded-lg px-3 py-2",children:n("option",{value:"",children:"Todos los tipos"})})]}),n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha Desde"}),n("input",{type:"date",id:"filter-date-from",className:"w-full border border-gray-300 rounded-lg px-3 py-2"})]}),n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha Hasta"}),n("input",{type:"date",id:"filter-date-to",className:"w-full border border-gray-300 rounded-lg px-3 py-2"})]}),n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Método de Pago"}),n("select",{id:"filter-payment-method",className:"w-full border border-gray-300 rounded-lg px-3 py-2",children:[n("option",{value:"",children:"Todos los métodos"}),n("option",{value:"cash",children:"Efectivo"}),n("option",{value:"credit_card",children:"Tarjeta de Crédito"}),n("option",{value:"debit_card",children:"Tarjeta de Débito"}),n("option",{value:"bank_transfer",children:"Transferencia"}),n("option",{value:"company_card",children:"Tarjeta Empresarial"}),n("option",{value:"petty_cash",children:"Caja Chica"})]})]})]}),n("div",{className:"flex space-x-4 mt-4",children:[n("button",{onclick:"applyFilters()",className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[n("i",{className:"fas fa-search mr-2"}),"Aplicar Filtros"]}),n("button",{onclick:"clearFilters()",className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700",children:[n("i",{className:"fas fa-times mr-2"}),"Limpiar"]}),n("button",{onclick:"exportFiltered('pdf')",className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700",children:[n("i",{className:"fas fa-file-pdf mr-2"}),"Exportar PDF"]}),n("button",{onclick:"exportFiltered('excel')",className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:[n("i",{className:"fas fa-file-excel mr-2"}),"Exportar Excel"]})]})]}),n("div",{className:"bg-white rounded-lg shadow-sm border",children:[n("div",{className:"px-6 py-4 border-b",children:n("div",{className:"flex justify-between items-center",children:[n("h3",{className:"text-lg font-semibold text-gray-900",children:"Lista de Gastos y Viáticos"}),n("div",{className:"flex space-x-2",children:[n("span",{id:"expenses-count",className:"text-sm text-gray-500",children:"0 gastos"}),n("span",{id:"expenses-total",className:"text-sm font-semibold text-gray-900",children:"$0.00"})]})]})}),n("div",{className:"overflow-x-auto",children:n("table",{className:"min-w-full divide-y divide-gray-200",children:[n("thead",{className:"bg-gray-50",children:n("tr",{children:[n("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:[n("input",{type:"checkbox",id:"select-all",className:"mr-2",onclick:"toggleSelectAll()"}),"ID"]}),n("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),n("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empresa"}),n("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Usuario"}),n("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monto Original"}),n("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monto MXN"}),n("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),n("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),n("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Adjuntos"}),n("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),n("tbody",{id:"expenses-table",className:"bg-white divide-y divide-gray-200",children:n("tr",{children:n("td",{colspan:"10",className:"px-6 py-4 text-center text-gray-500",children:"Cargando gastos..."})})})]})})]})]}),n("div",{id:"expense-modal",className:"fixed inset-0 z-50 hidden",children:[n("div",{className:"fixed inset-0 bg-black bg-opacity-50",onclick:"closeExpenseForm()"}),n("div",{className:"fixed inset-0 overflow-y-auto",children:n("div",{className:"flex min-h-full items-center justify-center p-4",children:n("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[n("div",{className:"px-6 py-4 border-b border-gray-200",children:[n("div",{className:"flex items-center justify-between",children:[n("h3",{className:"text-lg font-semibold text-gray-900",children:[n("i",{className:"fas fa-plus-circle mr-2 text-green-600"}),"Registrar Nuevo Gasto o Viático"]}),n("button",{onclick:"closeExpenseForm()",className:"text-gray-400 hover:text-gray-600",children:n("i",{className:"fas fa-times text-xl"})})]}),n("p",{className:"text-sm text-gray-500 mt-1",children:"Complete todos los campos requeridos. Los campos marcados con * son obligatorios."})]}),n("form",{id:"expense-form",className:"px-6 py-4",children:[n("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n("div",{className:"space-y-4",children:[n("h4",{className:"font-semibold text-gray-900 border-b pb-2",children:"📋 Información Básica"}),n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Empresa * ",n("i",{className:"fas fa-building ml-1 text-blue-500"})]}),n("select",{id:"form-company",required:!0,className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:n("option",{value:"",children:"Seleccione una empresa..."})})]}),n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Tipo de Gasto * ",n("i",{className:"fas fa-tags ml-1 text-purple-500"})]}),n("select",{id:"form-expense-type",required:!0,className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:n("option",{value:"",children:"Seleccione tipo de gasto..."})})]}),n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Descripción * ",n("i",{className:"fas fa-edit ml-1 text-green-500"})]}),n("textarea",{id:"form-description",required:!0,rows:"3",placeholder:"Ej: Comida con cliente - Proyecto Alpha",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Fecha del Gasto * ",n("i",{className:"fas fa-calendar ml-1 text-red-500"})]}),n("input",{type:"date",id:"form-expense-date",required:!0,className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Responsable ",n("i",{className:"fas fa-user ml-1 text-indigo-500"})]}),n("select",{id:"form-responsible",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:n("option",{value:"",children:"Yo (usuario actual)"})})]}),n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Integrantes ",n("i",{className:"fas fa-users ml-1 text-orange-500"})]}),n("textarea",{id:"form-attendees",rows:"2",placeholder:"Ej: María López, Carlos Martínez (opcional)",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),n("div",{className:"space-y-4",children:[n("h4",{className:"font-semibold text-gray-900 border-b pb-2",children:"💰 Información Financiera"}),n("div",{className:"grid grid-cols-2 gap-3",children:[n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Monto * ",n("i",{className:"fas fa-dollar-sign ml-1 text-green-600"})]}),n("input",{type:"number",step:"0.01",id:"form-amount",required:!0,placeholder:"0.00",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Moneda * ",n("i",{className:"fas fa-coins ml-1 text-yellow-600"})]}),n("select",{id:"form-currency",required:!0,className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onchange:"updateExchangeRate()",children:[n("option",{value:"",children:"Seleccionar..."}),n("option",{value:"MXN",children:"🇲🇽 MXN"}),n("option",{value:"USD",children:"🇺🇸 USD"}),n("option",{value:"EUR",children:"🇪🇺 EUR"})]})]})]}),n("div",{id:"exchange-rate-section",className:"hidden",children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Tipo de Cambio ",n("i",{className:"fas fa-exchange-alt ml-1 text-blue-600"})]}),n("div",{className:"flex items-center space-x-2",children:[n("input",{type:"number",step:"0.000001",id:"form-exchange-rate",readonly:!0,className:"flex-1 border border-gray-300 rounded-lg px-3 py-2 bg-gray-50"}),n("button",{type:"button",onclick:"refreshExchangeRate()",className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:n("i",{className:"fas fa-sync-alt"})})]}),n("p",{id:"exchange-rate-info",className:"text-xs text-gray-500 mt-1"})]}),n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Método de Pago * ",n("i",{className:"fas fa-credit-card ml-1 text-purple-600"})]}),n("select",{id:"form-payment-method",required:!0,className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[n("option",{value:"",children:"Seleccione método..."}),n("option",{value:"cash",children:"💵 Efectivo"}),n("option",{value:"credit_card",children:"💳 Tarjeta de Crédito"}),n("option",{value:"debit_card",children:"💳 Tarjeta de Débito"}),n("option",{value:"bank_transfer",children:"🏦 Transferencia Bancaria"}),n("option",{value:"company_card",children:"🏢 Tarjeta Empresarial"}),n("option",{value:"petty_cash",children:"🪙 Caja Chica"})]})]}),n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Proveedor/Establecimiento ",n("i",{className:"fas fa-store ml-1 text-teal-500"})]}),n("input",{type:"text",id:"form-vendor",placeholder:"Ej: Restaurante Pujol, Uber, Adobe Inc",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Número de Factura/Folio ",n("i",{className:"fas fa-receipt ml-1 text-gray-600"})]}),n("input",{type:"text",id:"form-invoice-number",placeholder:"Ej: A123456789",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Estado Inicial ",n("i",{className:"fas fa-flag ml-1 text-yellow-500"})]}),n("select",{id:"form-status",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[n("option",{value:"pending",children:"⏳ Pendiente"}),n("option",{value:"approved",children:"✅ Aprobado"})]})]}),n("div",{className:"flex items-center space-x-2",children:[n("input",{type:"checkbox",id:"form-billable",className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),n("label",{for:"form-billable",className:"text-sm font-medium text-gray-700",children:[n("i",{className:"fas fa-file-invoice-dollar mr-1 text-green-600"}),"Gasto Facturable al Cliente"]})]})]})]}),n("div",{className:"mt-6",children:[n("h4",{className:"font-semibold text-gray-900 border-b pb-2 mb-4",children:"📝 Información Adicional"}),n("div",{children:[n("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Notas y Comentarios ",n("i",{className:"fas fa-sticky-note ml-1 text-yellow-500"})]}),n("textarea",{id:"form-notes",rows:"3",placeholder:"Información adicional, contexto del gasto, observaciones...",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),n("div",{className:"mt-6",children:[n("h4",{className:"font-semibold text-gray-900 border-b pb-2 mb-4",children:"📎 Archivos Adjuntos"}),n("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[n("i",{className:"fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"}),n("p",{className:"text-gray-600 mb-2",children:"Arrastra archivos aquí o haz clic para seleccionar"}),n("p",{className:"text-sm text-gray-500",children:"Tickets, facturas PDF/XML, fotografías (Max: 10MB por archivo)"}),n("input",{type:"file",id:"form-attachments",multiple:!0,accept:".pdf,.xml,.jpg,.jpeg,.png,.gif",className:"hidden",onchange:"handleFileSelect(event)"}),n("button",{type:"button",onclick:"document.getElementById('form-attachments').click()",className:"mt-3 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[n("i",{className:"fas fa-paperclip mr-2"}),"Seleccionar Archivos"]})]}),n("div",{id:"attachments-preview",className:"mt-4 hidden",children:[n("h5",{className:"font-medium text-gray-900 mb-2",children:"Archivos Seleccionados:"}),n("div",{id:"attachments-list",className:"space-y-2"})]})]}),n("div",{className:"mt-8 flex justify-end space-x-4 pt-6 border-t border-gray-200",children:[n("button",{type:"button",onclick:"closeExpenseForm()",className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:[n("i",{className:"fas fa-times mr-2"}),"Cancelar"]}),n("button",{type:"button",onclick:"saveDraft()",className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:[n("i",{className:"fas fa-save mr-2"}),"Guardar Borrador"]}),n("button",{type:"submit",className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[n("i",{className:"fas fa-check mr-2"}),"Registrar Gasto"]})]})]})]})})})]})]})));const Vt=new Ur,Os=Object.assign({"/src/index.tsx":S});let Br=!1;for(const[,e]of Object.entries(Os))e&&(Vt.all("*",t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),Vt.notFound(t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),Br=!0);if(!Br)throw new Error("Can't import modules from ['/src/index.ts','/src/index.tsx','/app/server.ts']");export{Vt as default};
